{"version":3,"sources":["../../src/RamachandranComponent.js"],"names":["Object","defineProperty","exports","value","d3","require","polymer_element_js_1","HeatMapContours_1","LineContours_1","parsePdb_1","RamachandranComponent","createChart","bind","fillColorFunction","pdb","default","pdbId","downloadAndParse","jsonObject","residueArray","outliersType","outlDict","rsrz","ramachandranOutliers","sidechainOutliers","ramaContourPlotType","contourColoringStyle","residueColorStyle","modelsToShowNumbers","modelsToShow","map","d","push","parseInt","rsrzCount","clashes","highlightedResidues","drawingType","compute","rama","num","includes","length","width","height","xScale","scaleLinear","domain","range","xBottomAxis","axisBottom","xTopAxis","axisTop","xValue","xMap","tooltip","select","append","attr","style","yScale","yLeftAxis","axisLeft","yRightAxis","axisRight","yValue","yMap","makeYGridlines","makeXGridlines","svgContainer","classed","canvasContainer","call","tickSize","text","selectAll","remove","colorSelect","on","property","updateChart","chainsToShow","plotTypeSelect","basicContours","ramaForm","sort","a","b","entityToShow","clickEvents","mouseOutEvents","favored","allowed","timeoutId","scrollTimer","lastScrollFireTime","now","objSize","window","screen","availWidth","outliersList","symbolTypes","circle","symbol","type","symbolCircle","size","triangle","symbolTriangle","switchPlotType","i","prePro","aa","cisPeptide","tooltipText","chain","phi","psi","getTimeout","setTimeout","changeOpacity","dispatchCustomEvent","name","event","CustomEvent","detail","chainId","entityId","modelId","entry","residueName","residueNumber","dispatchEvent","changeContours","data","toDefault","makeInvisible","residues","split","nodes","document","querySelectorAll","Array","from","filter","__data__","id","forEach","opacity","fill","changeObjectSize","smaller","unHighlightObject","eventData","indexOf","getResidueNode","transition","duration","opacityFunction","onClick","res","dat","pop","highLightObject","sortJson","enter","idSlector","merge","highlightColor","Date","getTime","html","tempStr","pageX","pageY","String","clearTimeout","outTime","toFixed","addEventListener","minMouseOverTime","mouseOver","contourColorStyle","clearCanvas","img","Image","svgImg","src","generalContour","lineGeneralContour","ileVal","lineIleVal","linePrePro","gly","lineGly","transPro","lineTransPro","cisPro","lineCisPro","context","node","getContext","clearRect","globalAlpha","onload","drawImage","outliersTable","sortedTable","rows","exit","cells","fillTmp","empty","reflectToAttribute","Number","element","HTMLElement","PolymerElement","customElements","define"],"mappings":"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","file":"RamachandranComponent.js","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst d3 = require(\"d3\");\r\nconst polymer_element_js_1 = require(\"@polymer/polymer/polymer-element.js\");\r\nconst HeatMapContours_1 = require(\"../contours/HeatMapContours\");\r\nconst LineContours_1 = require(\"../contours/LineContours\");\r\nrequire(\"bootstrap/dist/css/bootstrap.css\");\r\nrequire(\"../public/index.css\");\r\nconst parsePdb_1 = require(\"./parsePdb\");\r\nclass RamachandranComponent extends polymer_element_js_1.PolymerElement {\r\n    connectedCallback() {\r\n        this.createChart = this.createChart.bind(this);\r\n        this.fillColorFunction = this.fillColorFunction.bind(this);\r\n        const pdb = new parsePdb_1.default(this.pdbId);\r\n        pdb.downloadAndParse();\r\n        this.jsonObject = pdb.residueArray;\r\n        this.outliersType = pdb.outlDict;\r\n        this.rsrz = pdb.rsrz;\r\n        this.ramachandranOutliers = 0;\r\n        this.sidechainOutliers = 0;\r\n        this.ramaContourPlotType = 1;\r\n        RamachandranComponent.contourColoringStyle = 1;\r\n        this.residueColorStyle = 1;\r\n        this.modelsToShowNumbers = [];\r\n        this.modelsToShow.map((d) => {\r\n            this.modelsToShowNumbers.push(parseInt(d));\r\n        });\r\n        this.rsrzCount = 0;\r\n        this.clashes = 0;\r\n        this.highlightedResidues = [];\r\n        this.createChart();\r\n    }\r\n    static get properties() {\r\n        return {\r\n            pdbId: {\r\n                type: String,\r\n                reflectToAttribute: true\r\n            },\r\n            chainsToShow: {\r\n                type: Array,\r\n                reflectToAttribute: true\r\n            },\r\n            modelsToShow: {\r\n                type: Array,\r\n                reflectToAttribute: true\r\n            },\r\n            residueColorStyle: {\r\n                type: Number,\r\n                reflectToAttribute: true\r\n            },\r\n            contourColoringStyle: {\r\n                type: Number,\r\n                reflectToAttribute: true\r\n            },\r\n            ramaContourPlotType: {\r\n                type: Number,\r\n                reflectToAttribute: true\r\n            },\r\n            element: {\r\n                type: HTMLElement,\r\n                reflectToAttribute: true\r\n            },\r\n        };\r\n    }\r\n    static get template() {\r\n        return null;\r\n    }\r\n    /**\r\n     * return fillColor which will be used\r\n     * @param d - one residue\r\n     * @param {number} drawingType Default - 1/Quality - 2/ RSRZ - 3\r\n     * @param outliersType\r\n     * @param rsrz\r\n     * @param {boolean} compute\r\n     * @returns {string} hex of color\r\n     */\r\n    fillColorFunction(d, drawingType, outliersType, rsrz, compute = false) {\r\n        switch (drawingType) {\r\n            case 1:\r\n                if (d.rama === 'OUTLIER') {\r\n                    return '#f00';\r\n                }\r\n                return 'black';\r\n            case 2:\r\n                if (typeof outliersType[d.num] === 'undefined') {\r\n                    return '#008000';\r\n                }\r\n                else {\r\n                    if (compute === true) {\r\n                        if (outliersType[d.num].outliersType.includes('clashes')) {\r\n                            this.clashes++;\r\n                        }\r\n                        if (outliersType[d.num].outliersType.includes('ramachandran_outliers')) {\r\n                            this.ramachandranOutliers++;\r\n                        }\r\n                        if (outliersType[d.num].outliersType.includes('sidechain_outliers')) {\r\n                            this.sidechainOutliers++;\r\n                        }\r\n                    }\r\n                    switch (outliersType[d.num].outliersType.length) {\r\n                        case 0:\r\n                            return '#008000';\r\n                        case 1:\r\n                            return '#ff0';\r\n                        case 2:\r\n                            return '#f80';\r\n                        default:\r\n                            return '#850013';\r\n                    }\r\n                }\r\n            case 3:\r\n                if (typeof rsrz[d.num] === 'undefined') {\r\n                    return 'black';\r\n                }\r\n                else {\r\n                    if (compute === true) {\r\n                        this.rsrzCount++;\r\n                    }\r\n                    return '#f00';\r\n                }\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     * how opaque node will be\r\n     * @param fillTmp\r\n     * @returns {number}\r\n     */\r\n    static opacityFunction(fillTmp) {\r\n        if (fillTmp === '#008000' || fillTmp === 'black') {\r\n            return 0.15;\r\n        }\r\n        if (fillTmp === '#ff0') {\r\n            return 0.8;\r\n        }\r\n        return 1;\r\n    }\r\n    /**\r\n     * creates basic chart, add axes, creates tooltip\r\n     */\r\n    createChart() {\r\n        let width = 500, height = 500;\r\n        if (width > 768) {\r\n            width = 580;\r\n        }\r\n        if (height > 768) {\r\n            height = 580;\r\n        }\r\n        // setup x\r\n        const xScale = d3.scaleLinear()\r\n            .domain([-180, 180])\r\n            .range([0, (width)]);\r\n        this.xBottomAxis = d3.axisBottom(xScale);\r\n        this.xTopAxis = d3.axisTop(xScale);\r\n        this.xTopAxis = d3.axisTop(xScale);\r\n        const xValue = (d) => d['phi'];\r\n        this.xMap = (d) => xScale(xValue(d));\r\n        // tooltip\r\n        this.tooltip = d3.select('body').append('div')\r\n            .attr('class', 'rama-tooltip')\r\n            .attr('height', 0)\r\n            .style('opacity', 0);\r\n        // setup y\r\n        const yScale = d3.scaleLinear()\r\n            .domain([180, -180])\r\n            .range([0, (height)]);\r\n        this.yLeftAxis = d3.axisLeft(yScale);\r\n        this.yRightAxis = d3.axisRight(yScale);\r\n        const yValue = (d) => d['psi'];\r\n        this.yMap = (d) => yScale(yValue(d));\r\n        function makeYGridlines() {\r\n            return d3.axisRight(yScale);\r\n        }\r\n        function makeXGridlines() {\r\n            return d3.axisTop(xScale);\r\n        }\r\n        this.svgContainer = d3.select('ramachandran-component').append('div')\r\n            .attr('id', 'rama-svg-container')\r\n            .attr('height', height)\r\n            .attr('border', '1px solid black')\r\n            .append('svg')\r\n            .attr('max-width', width)\r\n            .classed('svg-container', true)\r\n            .attr('id', 'rama-svg')\r\n            .attr('preserveAspectRatio', 'xMinYMin meet')\r\n            .attr('viewBox', '0 0 ' + width + ' ' + height)\r\n            .classed('svg-content-responsive', true)\r\n            .style('overflow', 'visible');\r\n        RamachandranComponent.canvasContainer = d3.select('#rama-svg-container')\r\n            .append('canvas')\r\n            .classed('img-responsive', true)\r\n            .attr('id', 'rama-canvas')\r\n            .attr('width', width)\r\n            .attr('height', height)\r\n            .classed('svg-content-responsive', true)\r\n            .attr('preserveAspectRatio', 'xMinYMin meet')\r\n            .attr('viewBox', '0 0 ' + width + ' ' + height)\r\n            .style('padding', '30px 30px 30px 50px')\r\n            .style('overflow', 'visible');\r\n        // console.log(this.canvasContainer);\r\n        // // add axes\r\n        this.svgContainer.append('g')\r\n            .call(this.xTopAxis)\r\n            .attr('id', 'x-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('transform', 'translate(0,' + (height) + ')')\r\n            .call(this.xBottomAxis)\r\n            .attr('id', 'x-axis');\r\n        this.svgContainer.append('g')\r\n            .call(this.yLeftAxis)\r\n            .attr('id', 'y-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('transform', () => 'translate(' + (width) + ', 0)')\r\n            .call(this.yRightAxis)\r\n            .attr('id', 'y-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('class', 'rama-grid')\r\n            .attr('transform', 'translate(0,' + height + ')')\r\n            .call(makeXGridlines()\r\n            .tickSize(width));\r\n        this.svgContainer.append('g')\r\n            .attr('class', 'rama-grid')\r\n            .call(makeYGridlines()\r\n            .tickSize(height));\r\n        // axis labels\r\n        // phi label\r\n        this.svgContainer.append('text')\r\n            .attr('x', width / 2)\r\n            .attr('y', height + 35)\r\n            .style('text-anchor', 'middle')\r\n            .style('fill', '#000')\r\n            .text('\\u03A6');\r\n        // psi label\r\n        this.svgContainer.append('text')\r\n            .attr('x', 0 - (height / 2))\r\n            .attr('y', -35)\r\n            .style('text-anchor', 'middle')\r\n            .style('fill', '#000')\r\n            .attr('transform', 'rotate(-90)')\r\n            .text('\\u03A8');\r\n        //\r\n        // // outliers headline\r\n        // d3.select('#rama-root').append('div')\r\n        //     .attr('class', 'rama-outliers-div')\r\n        //     .append('div')\r\n        //     .attr('class', 'rama-outliers-headline')\r\n        //     .append('h4')\r\n        //     .text('OUTLIERS');\r\n        //\r\n        // d3.select('.rama-outliers-div').append('div')\r\n        //     .attr('class', 'outliers-container');\r\n        d3.selectAll('g.rama-grid g.tick text').remove();\r\n        d3.select('#rama-svg-container').append('div').attr('id', 'rama-sum').attr('class', 'rama-set-cl');\r\n        d3.select('#rama-svg-container').append('div').attr('id', 'rama-settings').attr('class', 'rama-set-cl');\r\n        let colorSelect = d3.select('#rama-settings').append('select').attr('id', 'rama-coloring');\r\n        colorSelect.append('option').attr('value', 1).text('Default');\r\n        colorSelect.append('option').attr('value', 2).text('Quality');\r\n        colorSelect.append('option').attr('value', 3).text('RSRZ');\r\n        colorSelect.on('change', () => {\r\n            this.residueColorStyle = parseInt(d3.select('#rama-coloring').property('value'));\r\n            this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShowNumbers, this.residueColorStyle);\r\n        });\r\n        let plotTypeSelect = d3.select('#rama-settings').append('select').attr('id', 'rama-plot-type');\r\n        plotTypeSelect.append('option').attr('value', 1).text('General case');\r\n        plotTypeSelect.append('option').attr('value', 2).text('Isoleucine and valine');\r\n        plotTypeSelect.append('option').attr('value', 3).text('Pre-proline');\r\n        plotTypeSelect.append('option').attr('value', 4).text('Glycine');\r\n        plotTypeSelect.append('option').attr('value', 5).text('Trans proline');\r\n        plotTypeSelect.append('option').attr('value', 6).text('Cis proline');\r\n        plotTypeSelect.on('change', () => {\r\n            this.ramaContourPlotType = parseInt(d3.select('#rama-plot-type').property('value'));\r\n            this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShowNumbers, this.residueColorStyle);\r\n            this.basicContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n        });\r\n        let ramaForm = d3.select('#rama-settings').append('form').attr('id', 'rama-contour-style');\r\n        ramaForm.append('label').classed('rama-contour-style', true).text('Contour').append('input')\r\n            .attr('type', 'radio')\r\n            .attr('name', 'contour-style')\r\n            .attr('value', 1)\r\n            .attr('checked', true)\r\n            .classed('rama-contour-radio', true);\r\n        ramaForm.append('label').classed('rama-contour-style', true).text('Heat Map').append('input')\r\n            .attr('type', 'radio')\r\n            .attr('name', 'contour-style')\r\n            .attr('value', 2)\r\n            .classed('rama-contour-radio', true);\r\n        ramaForm.on('change', () => {\r\n            RamachandranComponent.contourColoringStyle = parseInt(d3.select('input[name=\"contour-style\"]:checked').property('value'));\r\n            this.basicContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n        });\r\n        this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShowNumbers, this.residueColorStyle);\r\n        this.basicContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n    }\r\n    /**\r\n     * sort json object to that it can be better displayed\r\n     * @param jsonObject\r\n     * @param {number} drawingType\r\n     * @param {any[]} outliersType\r\n     * @param {any[]} rsrz\r\n     */\r\n    sortJson(jsonObject, drawingType, outliersType, rsrz) {\r\n        jsonObject.sort((a, b) => {\r\n            switch (drawingType) {\r\n                case 1:\r\n                    if (a.rama === 'OUTLIER') {\r\n                        if (b.rama === 'Allowed') {\r\n                            return 1;\r\n                        }\r\n                        if (b.rama === 'Favored') {\r\n                            return 1;\r\n                        }\r\n                        if (b.rama === 'OUTLIER') {\r\n                            return 0;\r\n                        }\r\n                    }\r\n                    if (a.rama === 'Allowed') {\r\n                        if (b.rama === 'Allowed') {\r\n                            return 0;\r\n                        }\r\n                        if (b.rama === 'Favored') {\r\n                            return 1;\r\n                        }\r\n                        if (b.rama === 'OUTLIER') {\r\n                            return -1;\r\n                        }\r\n                    }\r\n                    if (a.rama === 'Favored') {\r\n                        if (b.rama === 'Allowed') {\r\n                            return -1;\r\n                        }\r\n                        if (b.rama === 'Favored') {\r\n                            return 0;\r\n                        }\r\n                        if (b.rama === 'OUTLIER') {\r\n                            return -1;\r\n                        }\r\n                    }\r\n                    break;\r\n                case 2:\r\n                    if (typeof outliersType[a.num] === 'undefined') {\r\n                        return -1;\r\n                    }\r\n                    else if (typeof outliersType[b.num] === 'undefined') {\r\n                        return 1;\r\n                    }\r\n                    else if (outliersType[a.num].outliersType.length > outliersType[b.num].outliersType.length) {\r\n                        return 1;\r\n                    }\r\n                    else {\r\n                        return -1;\r\n                    }\r\n                case 3:\r\n                    if (typeof rsrz[a.num] === 'undefined') {\r\n                        return -1;\r\n                    }\r\n                    else if (typeof rsrz[b.num] === 'undefined') {\r\n                        return 1;\r\n                    }\r\n                    else {\r\n                        return 1;\r\n                    }\r\n                default:\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * change residues in chart\r\n     * @param {any[]} chainsToShow\r\n     * @param {number} ramaContourPlotType\r\n     * @param {number[]} entityToShow\r\n     * @param {number} drawingType\r\n     */\r\n    updateChart(chainsToShow, ramaContourPlotType, entityToShow, drawingType) {\r\n        this.svgContainer.selectAll('g.dataGroup').remove();\r\n        let width = 500;\r\n        const { jsonObject, fillColorFunction, outliersType, rsrz, basicContours, tooltip } = this;\r\n        const clickEvents = ['PDB.litemol.click', 'PDB.topologyViewer.click'];\r\n        const mouseOutEvents = ['PDB.topologyViewer.mouseout', 'PDB.litemol.mouseout'];\r\n        let { highlightedResidues } = this;\r\n        let favored = 0;\r\n        let allowed = 0;\r\n        let timeoutId = null;\r\n        let scrollTimer, lastScrollFireTime = 0;\r\n        let now;\r\n        if (width > 768) {\r\n            width = 580;\r\n        }\r\n        // if (height > 768) {\r\n        //     height = 580;\r\n        // }\r\n        let objSize = 40;\r\n        if (window.screen.availWidth < 1920) {\r\n            objSize = 30;\r\n        }\r\n        if (window.screen.width < 350) {\r\n            objSize = 5;\r\n        }\r\n        const pdbId = this.pdbId;\r\n        const outliersList = [];\r\n        // scales\r\n        const xScale = d3.scaleLinear()\r\n            .domain([-180, 180])\r\n            .range([0, (width)]);\r\n        // .range([0, (0.985 * width)]);\r\n        const yScale = d3.scaleLinear()\r\n            .domain([180, -180])\r\n            .range([0, (width)]);\r\n        // symbolTypes\r\n        const symbolTypes = {\r\n            circle: d3.symbol().type(d3.symbolCircle).size(objSize),\r\n            triangle: d3.symbol().type(d3.symbolTriangle).size(objSize)\r\n        };\r\n        /**\r\n         * determines which residues will be displayed depending on ramaContourPlotType\r\n         * @param d\r\n         * @param {number} i\r\n         * @returns {any}\r\n         */\r\n        function switchPlotType(d, i) {\r\n            let prePro = false;\r\n            if (i + 1 != jsonObject.length && jsonObject[i + 1].aa == 'PRO') {\r\n                d.prePro = true;\r\n                prePro = true;\r\n            }\r\n            switch (ramaContourPlotType) {\r\n                case 1:\r\n                    return d;\r\n                case 2:\r\n                    if (d.aa == 'ILE' || d.aa == 'VAL') {\r\n                        return d;\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    if (prePro)\r\n                        return d;\r\n                    break;\r\n                case 4:\r\n                    if (d.aa == 'GLY') {\r\n                        return d;\r\n                    }\r\n                    break;\r\n                case 5:\r\n                    if (d.cisPeptide == null && d.aa == 'PRO') {\r\n                        return d;\r\n                    }\r\n                    break;\r\n                case 6:\r\n                    if (d.cisPeptide == 'Y' && d.aa == 'PRO') {\r\n                        return d;\r\n                    }\r\n                    break;\r\n                default:\r\n                    return d;\r\n            }\r\n        }\r\n        /**\r\n         * text for tooltip\r\n         * @param d\r\n         * @returns {string}\r\n         */\r\n        function tooltipText(d) {\r\n            // language=HTML\r\n            return `<b>${d.chain} ${d.num} ${d.aa}</b><br/>\\u03A6: ${d.phi}<br/>\\u03A8: ${d.psi}`;\r\n        }\r\n        /**\r\n         * return timeoutid when hovering\r\n         * @param {number} ramaContourPlotType\r\n         * @param {string} aa\r\n         * @returns {number}\r\n         */\r\n        function getTimeout(ramaContourPlotType, aa = '') {\r\n            return window.setTimeout(() => {\r\n                basicContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                changeOpacity(aa);\r\n            }, 600);\r\n        }\r\n        /**\r\n         * throw new event with defined data\r\n         * @param {string} name name of event\r\n         * @param d node\r\n         */\r\n        function dispatchCustomEvent(name, d) {\r\n            const event = new CustomEvent(name, { detail: {\r\n                    chainId: d.chain,\r\n                    entityId: d.modelId,\r\n                    entry: pdbId,\r\n                    residueName: d.aa,\r\n                    residueNumber: d.num\r\n                } });\r\n            window.dispatchEvent(event);\r\n        }\r\n        /**\r\n         * function for change contours after mouseout or mouseover\r\n         * @param data selected node\r\n         * @param toDefault true if used for return to base state\r\n         */\r\n        function changeContours(data, toDefault = true) {\r\n            switch (data.aa) {\r\n                case 'ILE':\r\n                case 'VAL':\r\n                    if (ramaContourPlotType != 2) {\r\n                        if (toDefault) {\r\n                            basicContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                            changeOpacity('VAL,ILE', false);\r\n                        }\r\n                        else {\r\n                            timeoutId = getTimeout(2, 'VAL,ILE');\r\n                        }\r\n                    }\r\n                    return;\r\n                case 'GLY':\r\n                    if (ramaContourPlotType != 4) {\r\n                        if (toDefault) {\r\n                            basicContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                            changeOpacity('GLY', false);\r\n                        }\r\n                        else {\r\n                            timeoutId = getTimeout(4, 'GLY');\r\n                        }\r\n                    }\r\n                    return;\r\n                case 'PRO':\r\n                    if (ramaContourPlotType < 5) {\r\n                        if (toDefault) {\r\n                            basicContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                            changeOpacity('PRO', false);\r\n                        }\r\n                        else {\r\n                            if (data.cisPeptide === null && data.aa === 'PRO') {\r\n                                timeoutId = getTimeout(5, 'PRO');\r\n                                break;\r\n                            }\r\n                            if (data.cisPeptide === 'Y' && data.aa === 'PRO') {\r\n                                timeoutId = getTimeout(6, 'PRO');\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    return;\r\n                default:\r\n                    break;\r\n            }\r\n            switch (data.prePro) {\r\n                case true:\r\n                    if (ramaContourPlotType != 3) {\r\n                        if (toDefault) {\r\n                            basicContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                            changeOpacity('', false);\r\n                        }\r\n                        else\r\n                            timeoutId = getTimeout(3, '');\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        /**\r\n         * function to change opacity while hovering\r\n         * @param {string} aa\r\n         * @param {boolean} makeInvisible\r\n         */\r\n        function changeOpacity(aa, makeInvisible = true) {\r\n            let residues = aa.split(',');\r\n            let nodes;\r\n            if (aa == '') {\r\n                nodes = document.querySelectorAll('g.dataGroup path');\r\n                nodes = Array.from(nodes).filter((d) => {\r\n                    return (d.__data__.prePro == false);\r\n                });\r\n            }\r\n            else if (residues.length > 1) {\r\n                nodes = document.querySelectorAll('g.dataGroup :not([id^=' + residues[0] + '])');\r\n                nodes = Array.from(nodes).filter((d) => {\r\n                    return !d.id.includes(residues[1]);\r\n                });\r\n            }\r\n            else {\r\n                nodes = document.querySelectorAll('g.dataGroup :not([id^=' + aa + '])');\r\n            }\r\n            [].forEach.call(nodes, (d) => {\r\n                if (makeInvisible)\r\n                    d.style.opacity = 0;\r\n                else {\r\n                    if (d.style.fill == 'rgb(0, 128, 0)' || d.style.fill == 'black' || d.style.fill == 'rgb(0, 0, 0)') {\r\n                        d.style.opacity = 0.15;\r\n                    }\r\n                    else if (d.style.fill == 'rgb(255, 255, 0)') {\r\n                        d.style.opacity = 0.8;\r\n                    }\r\n                    else {\r\n                        d.style.opacity = 1;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * change object size on hover\r\n         * @param d\r\n         * @param {boolean} smaller\r\n         * @returns {string | null}\r\n         */\r\n        function changeObjectSize(d, smaller = true) {\r\n            let size = 175;\r\n            if (smaller) {\r\n                size = objSize;\r\n            }\r\n            if (d.aa === 'GLY') {\r\n                symbolTypes.triangle.size(size);\r\n                return symbolTypes.triangle();\r\n            }\r\n            symbolTypes.circle.size(size);\r\n            return symbolTypes.circle();\r\n        }\r\n        /**\r\n         * unhighlight residue from event\r\n         * @param event\r\n         */\r\n        function unHighlightObject(event) {\r\n            if (typeof event.eventData != 'undefined') {\r\n                if (highlightedResidues.indexOf(getResidueNode(event)) == -1) {\r\n                    d3.select('.selected-res')\r\n                        .classed('selected-res', false)\r\n                        .attr('d', (d) => changeObjectSize(d)).transition().duration(50)\r\n                        .style('fill', (d) => fillColorFunction(d, drawingType, outliersType, rsrz, true))\r\n                        .style('opacity', (d) => {\r\n                        return RamachandranComponent.opacityFunction(fillColorFunction(d, drawingType, outliersType, rsrz));\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        /**\r\n         * onClick event\r\n         * @param event\r\n         */\r\n        function onClick(event) {\r\n            const res = getResidueNode(event);\r\n            if (highlightedResidues.length != 0) {\r\n                highlightedResidues.forEach((d) => {\r\n                    d.attr('d', (d) => changeObjectSize(d)).transition().duration(50)\r\n                        .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz))\r\n                        .style('opacity', (d) => {\r\n                        return RamachandranComponent.opacityFunction(fillColorFunction(d, drawingType, outliersType, rsrz));\r\n                    });\r\n                });\r\n                highlightedResidues.pop();\r\n            }\r\n            highlightedResidues.push(res);\r\n            getResidueNode(event).attr('d', (d) => changeObjectSize(d, false))\r\n                .classed('selected-res', false)\r\n                .style('fill', 'magenta')\r\n                .style('opacity', '1');\r\n        }\r\n        /**\r\n         * return residue node from event\r\n         * @param event\r\n         * @returns {any}\r\n         */\r\n        function getResidueNode(event) {\r\n            if (typeof event.eventData.chainId == 'undefined')\r\n                return null;\r\n            return d3.select('path#' +\r\n                event.eventData.residueName + '-' +\r\n                event.eventData.chainId + '-' +\r\n                event.eventData.entityId + '-' +\r\n                event.eventData.residueNumber);\r\n        }\r\n        /**\r\n         * highlight residue from event\r\n         * @param event\r\n         */\r\n        function highLightObject(event) {\r\n            let res = getResidueNode(event);\r\n            if (res) {\r\n                res.attr('d', (d) => changeObjectSize(d, false))\r\n                    .classed('selected-res', true)\r\n                    .style('fill', 'yellow')\r\n                    .style('opacity', '1');\r\n                // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n            }\r\n        }\r\n        // sort because of svg z-index\r\n        this.sortJson(this.jsonObject, drawingType, outliersType, rsrz);\r\n        // outliersText\r\n        d3.selectAll('.outliers').remove();\r\n        d3.selectAll('table').remove();\r\n        this.svgContainer.selectAll('.shapes')\r\n            .data(jsonObject.filter((d, i) => {\r\n            if (chainsToShow.indexOf(d.chain) !== -1 && entityToShow.indexOf(d.modelId) !== -1) {\r\n                if (d.phi !== null || d.psi !== null) {\r\n                    return switchPlotType(d, i);\r\n                }\r\n            }\r\n        }))\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', 'dataGroup')\r\n            .append('path')\r\n            .attr('id', (d) => {\r\n            const id = d.aa + '-' + d.chain + '-' + d.modelId + '-' + d.num;\r\n            d.idSlector = id;\r\n            if (drawingType !== 3) {\r\n                if (d.rama === 'OUTLIER') {\r\n                    outliersList.push(d);\r\n                }\r\n                if (d.rama === 'Favored') {\r\n                    favored++;\r\n                }\r\n                if (d.rama === 'Allowed') {\r\n                    allowed++;\r\n                }\r\n                return id;\r\n            }\r\n            if (d.rama === 'OUTLIER' && typeof rsrz[d.num] !== 'undefined') {\r\n                outliersList.push(d);\r\n                return id;\r\n            }\r\n            return id;\r\n        })\r\n            .attr('d', (d) => {\r\n            if (d.aa === 'GLY') {\r\n                return symbolTypes.triangle();\r\n            }\r\n            return symbolTypes.circle();\r\n        })\r\n            .attr('transform', (d) => 'translate(' + xScale(d.phi) + ',' + yScale(d.psi) + ')')\r\n            .merge(this.svgContainer)\r\n            // .style('fill', 'transparent')\r\n            .style('fill', (d) => fillColorFunction(d, drawingType, outliersType, rsrz, true))\r\n            .style('opacity', (d) => {\r\n            return RamachandranComponent.opacityFunction(fillColorFunction(d, drawingType, outliersType, rsrz));\r\n        })\r\n            .on('mouseover', function (d) {\r\n            let height = 58;\r\n            let width = 90;\r\n            let highlightColor = 'yellow';\r\n            dispatchCustomEvent('PDB.ramaViewer.mouseOver', d);\r\n            now = new Date().getTime();\r\n            changeContours(d, false);\r\n            switch (drawingType) {\r\n                case 1:\r\n                    if (d.rama === 'Favored') {\r\n                        tooltip.html(tooltipText(d) + '<br/> Favored');\r\n                    }\r\n                    if (d.rama === 'Allowed') {\r\n                        tooltip.html(tooltipText(d) + '<br/> Allowed');\r\n                    }\r\n                    if (d.rama === 'OUTLIER') {\r\n                        tooltip.html(tooltipText(d) + '<br/><b>OUTLIER</b>');\r\n                    }\r\n                    break;\r\n                case 2:\r\n                    let tempStr = '';\r\n                    highlightColor = 'magenta';\r\n                    if (typeof outliersType[d.num] === 'undefined') {\r\n                        tooltip.html(tooltipText(d));\r\n                        break;\r\n                    }\r\n                    if (outliersType[d.num].outliersType.includes('clashes')) {\r\n                        tempStr += '<br/>Clash';\r\n                    }\r\n                    if (outliersType[d.num].outliersType.includes('ramachandran_outliers')) {\r\n                        tempStr += '<br/>Ramachandran outlier';\r\n                        width += 40;\r\n                    }\r\n                    if (outliersType[d.num].outliersType.includes('sidechain_outliers')) {\r\n                        tempStr += '<br/>Sidechain outlier';\r\n                        width += 10;\r\n                    }\r\n                    if (outliersType[d.num].outliersType.includes('bond_angles')) {\r\n                        tempStr += '<br/>Bond angles';\r\n                    }\r\n                    else {\r\n                        tooltip.html(tooltipText(d));\r\n                    }\r\n                    switch (outliersType[d.num].outliersType.length) {\r\n                        case 2:\r\n                            height += 10;\r\n                            break;\r\n                        case 3:\r\n                            height += 20;\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                    tooltip.html(tooltipText(d) + tempStr);\r\n                    break;\r\n                case 3:\r\n                    if (typeof rsrz[d.num] === 'undefined') {\r\n                        tooltip.html(tooltipText(d));\r\n                    }\r\n                    else {\r\n                        tooltip.html(tooltipText(d) + '<br/><b>RSRZ outlier</b>');\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            tooltip.transition()\r\n                .style('opacity', .95)\r\n                .style('left', (d3.event.pageX + 10) + 'px')\r\n                .style('top', (d3.event.pageY - 48) + 'px')\r\n                .style('height', height)\r\n                .style('width', String(width) + 'px');\r\n            d3.select(this)\r\n                .attr('d', (d) => changeObjectSize(d, false))\r\n                .style('fill', highlightColor)\r\n                .style('opacity', 1);\r\n            // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n        })\r\n            .on('mouseout', function (d) {\r\n            window.clearTimeout(timeoutId);\r\n            let outTime = new Date().getTime();\r\n            dispatchCustomEvent('PDB.ramaViewer.mouseOut', d);\r\n            if (highlightedResidues.indexOf(d) > -1) {\r\n                return;\r\n            }\r\n            d3.select(this)\r\n                .transition()\r\n                // .duration(50)\r\n                .attr('d', (dat) => changeObjectSize(dat))\r\n                // .style('fill', 'transparent')\r\n                .style('fill', (d) => fillColorFunction(d, drawingType, outliersType, rsrz))\r\n                .style('opacity', (d) => {\r\n                return RamachandranComponent.opacityFunction(fillColorFunction(d, drawingType, outliersType, rsrz));\r\n            });\r\n            // .style('fillColorFunction-width', '0.5');\r\n            tooltip.transition()\r\n                // .duration(50)\r\n                .style('opacity', 0);\r\n            if ((outTime - now) > 800) {\r\n                changeContours(d);\r\n            }\r\n        });\r\n        // .on('click', function(d: any) {\r\n        //     if (highlightedResidues.length != 0) {\r\n        //         highlightedResidues.forEach((d: any) => {\r\n        //             d3.select('#' + d.idSlector)\r\n        //                 .attr('d', (d: any) => changeObjectSize(d)).transition().duration(50)\r\n        //                 .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz))\r\n        //                 .style('opacity', (d) => {\r\n        //                     return RamachandranComponent.opacityFunction(fillColorFunction(d, drawingType, outliersType, rsrz))\r\n        //                 });\r\n        //         });\r\n        //         highlightedResidues.pop();\r\n        //     }\r\n        //     dispatchCustomEvent('PDB.ramaViewer.click', d);\r\n        //     highlightedResidues.push(d);\r\n        //     d3.select(this)\r\n        //         .attr('d', (d: any) => changeObjectSize(d, false))\r\n        //         .style('fill', 'magenta')\r\n        //         .style('opacity', 1);\r\n        //         // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n        // });\r\n        outliersList.sort((a, b) => a.num - b.num);\r\n        /**\r\n         * switch for summary info\r\n         */\r\n        switch (drawingType) {\r\n            case 1:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('Preferred regions: ' + String(favored)\r\n                    + ' (' + String((favored / jsonObject.length * 100).toFixed(0))\r\n                    + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-middle')\r\n                    .text('Allowed regions: ' + String(allowed)\r\n                    + ' (' + String((allowed / jsonObject.length * 100).toFixed(0))\r\n                    + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-thinnest')\r\n                    .text('Outliers: ' + String(outliersList.length)\r\n                    + ' (' + String((outliersList.length / jsonObject.length * 100).toFixed(0)) + '%)').enter();\r\n                break;\r\n            case 2:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('Ramachandran outliers: ' + String(this.ramachandranOutliers)\r\n                    + ' (' + String((this.ramachandranOutliers / jsonObject.length * 100).toFixed(0)) +\r\n                    '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-middle')\r\n                    .text('Sidechain outliers: ' + String(this.sidechainOutliers)\r\n                    + ' (' + String((this.sidechainOutliers / jsonObject.length * 100).toFixed(0)) + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-thinnest')\r\n                    .text('Clashes: ' + String(this.clashes)\r\n                    + ' (' + String((this.clashes / jsonObject.length * 100).toFixed(0)) + '%)').enter();\r\n                break;\r\n            case 3:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('RSRZ: ' + String(this.rsrzCount)\r\n                    + ' (' + String((this.rsrzCount / jsonObject.length * 100).toFixed(0)) + '%) ').enter();\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        /**\r\n         * add event listeners\r\n         */\r\n        clickEvents.forEach((type) => {\r\n            window.addEventListener(type, (event) => {\r\n                onClick(event);\r\n            });\r\n        });\r\n        mouseOutEvents.forEach((type) => {\r\n            window.addEventListener(type, (event) => {\r\n                if (highlightedResidues.indexOf(event) > -1) {\r\n                    return;\r\n                }\r\n                unHighlightObject(event);\r\n            });\r\n        });\r\n        window.addEventListener('PDB.topologyViewer.mouseover', (event) => {\r\n            const minMouseOverTime = 150;\r\n            let now = new Date().getTime();\r\n            function mouseOver(event) {\r\n                if (typeof event.eventData != 'undefined') {\r\n                    let res = getResidueNode(event);\r\n                    if (res) {\r\n                        if (res.attr('style').includes('magenta')) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    unHighlightObject(event);\r\n                    highLightObject(event);\r\n                }\r\n                else {\r\n                    unHighlightObject(event);\r\n                }\r\n            }\r\n            if (!scrollTimer) {\r\n                if (now - lastScrollFireTime > (3 * minMouseOverTime)) {\r\n                    mouseOver(event); // fire immediately on first scroll\r\n                    lastScrollFireTime = now;\r\n                }\r\n                scrollTimer = setTimeout(function () {\r\n                    scrollTimer = null;\r\n                    lastScrollFireTime = new Date().getTime();\r\n                    mouseOver(event);\r\n                }, minMouseOverTime);\r\n            }\r\n        });\r\n        window.addEventListener('PDB.litemol.mouseover', (event) => {\r\n            if (typeof event.eventData != 'undefined') {\r\n                let res = getResidueNode(event);\r\n                if (res) {\r\n                    if (res.attr('style').includes('magenta')) {\r\n                        return;\r\n                    }\r\n                }\r\n                unHighlightObject(event);\r\n                highLightObject(event);\r\n            }\r\n            else {\r\n                unHighlightObject(event);\r\n            }\r\n        });\r\n        // reset counters\r\n        this.sidechainOutliers = 0;\r\n        this.rsrzCount = 0;\r\n        this.clashes = 0;\r\n        this.ramachandranOutliers = 0;\r\n        // this.addTable(outliersList, drawingType);\r\n    }\r\n    static clearCanvas() {\r\n        d3.select('#rama-canvas').empty();\r\n        d3.selectAll('.contour-line').remove();\r\n    }\r\n    basicContours(ramaContourPlotType, contourColorStyle) {\r\n        RamachandranComponent.clearCanvas();\r\n        let width = 500, height = 500;\r\n        if (width > 768) {\r\n            width = 580;\r\n        }\r\n        if (height > 768) {\r\n            height = 580;\r\n        }\r\n        const img = new Image();\r\n        const svgImg = new Image();\r\n        switch (ramaContourPlotType) {\r\n            case 1:\r\n                img.src = HeatMapContours_1.generalContour;\r\n                svgImg.src = LineContours_1.lineGeneralContour;\r\n                break;\r\n            case 2:\r\n                img.src = HeatMapContours_1.ileVal;\r\n                svgImg.src = LineContours_1.lineIleVal;\r\n                break;\r\n            case 3:\r\n                img.src = HeatMapContours_1.prePro;\r\n                svgImg.src = LineContours_1.linePrePro;\r\n                break;\r\n            case 4:\r\n                img.src = HeatMapContours_1.gly;\r\n                svgImg.src = LineContours_1.lineGly;\r\n                break;\r\n            case 5:\r\n                img.src = HeatMapContours_1.transPro;\r\n                svgImg.src = LineContours_1.lineTransPro;\r\n                break;\r\n            case 6:\r\n                img.src = HeatMapContours_1.cisPro;\r\n                svgImg.src = LineContours_1.lineCisPro;\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        const context = RamachandranComponent.canvasContainer.node().getContext('2d');\r\n        context.clearRect(0, 0, width + 80, height + 60);\r\n        if (contourColorStyle == 2) {\r\n            context.globalAlpha = 0.6;\r\n            img.onload = () => {\r\n                context.drawImage(img, 0, 0, width, height * img.height / img.width);\r\n            };\r\n        }\r\n        else {\r\n            context.globalAlpha = 1;\r\n            svgImg.onload = () => {\r\n                context.drawImage(svgImg, 0, 0, width, height * svgImg.height / svgImg.width);\r\n            };\r\n        }\r\n    }\r\n    addTable() {\r\n        this.outliersTable = d3.select('.outliers-container').append('div')\r\n            .attr('class', 'outliers').append('table')\r\n            .attr('class', 'table table-hover table-responsive');\r\n        d3.select('.outliers-container').append('table')\r\n            .attr('class', 'rama-outliers-table').append('thead').append('tr').attr('id', 'tab-headline');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Chain')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('ID')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('AA')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Phi')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Psi')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n    }\r\n    fillTable(sortedTable, drawingType) {\r\n        let objSize = 40;\r\n        const { fillColorFunction, outliersType, rsrz } = this;\r\n        if (window.screen.availWidth < 1920) {\r\n            objSize = 30;\r\n        }\r\n        if (window.screen.width < 350) {\r\n            objSize = 5;\r\n        }\r\n        const symbolTypes = {\r\n            circle: d3.symbol().type(d3.symbolCircle).size(30),\r\n            triangle: d3.symbol().type(d3.symbolTriangle).size(30)\r\n        };\r\n        const rows = this.outliersTable.selectAll('tbody tr')\r\n            .data(sortedTable, (d) => d.num);\r\n        rows.enter()\r\n            .append('tr')\r\n            .on('mouseover', function (d) {\r\n            d3.select(this)\r\n                .style('background-color', '#b4bed6')\r\n                .style('cursor', 'pointer');\r\n            d3.select('#' + '-' + d.chain + '-' + d.modelId + '-' + d.num)\r\n                .attr('d', (dat) => {\r\n                if (dat.aa === 'GLY') {\r\n                    symbolTypes.triangle.size(175);\r\n                    return symbolTypes.triangle();\r\n                }\r\n                symbolTypes.circle.size(175);\r\n                return symbolTypes.circle();\r\n            })\r\n                .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n        })\r\n            //\r\n            .on('mouseout', function (d) {\r\n            d3.select(this)\r\n                .style('background-color', 'transparent')\r\n                .style('cursor', 'default');\r\n            d3.select('#' + d.aa + '-' + d.chain + '-' + d.modelId + '-' + d.num)\r\n                .transition()\r\n                // .duration(50)\r\n                .attr('d', (dat) => {\r\n                if (dat.aa === 'GLY') {\r\n                    symbolTypes.triangle.size(objSize);\r\n                    return symbolTypes.triangle();\r\n                }\r\n                symbolTypes.circle.size(objSize);\r\n                return symbolTypes.circle();\r\n            })\r\n                .style('fill', (d) => fillColorFunction(d, drawingType, outliersType, rsrz))\r\n                .style('fillColorFunction-width', '0.5');\r\n        })\r\n            .selectAll('td')\r\n            .data((d) => [d.chain, d.num, d.aa, d.phi, d.psi])\r\n            .enter()\r\n            .append('td')\r\n            .attr('id', 'rama-td')\r\n            .style('width', '30%')\r\n            .style('min-width', '50px')\r\n            .style('text-align', 'right')\r\n            .text((d) => d);\r\n        rows.exit().remove();\r\n        //\r\n        const cells = rows.selectAll('td')\r\n            .data((d) => [d.chain, d.num, d.aa, d.phi, d.psi])\r\n            .text((d) => d);\r\n        //\r\n        cells.enter()\r\n            .append('td')\r\n            .text((d) => d);\r\n        cells.exit().remove();\r\n    }\r\n}\r\nwindow.customElements.define('ramachandran-component', RamachandranComponent);\r\n"]}