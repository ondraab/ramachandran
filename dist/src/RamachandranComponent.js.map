{"version":3,"sources":["../../src/RamachandranComponent.js"],"names":["Object","defineProperty","exports","value","d3","require","polymer_element_js_1","HeatMapContours_1","LineContours_1","parsePdb_1","RamachandranComponent","height","width","createChart","bind","fillColorFunction","pdb","default","pdbId","downloadAndParse","molecules","moleculs","outliersType","outlDict","rsrz","hiddenResidues","selectedResidues","ramachandranOutliers","sidechainOutliers","favored","allowed","outliersList","ramaContourPlotType","contourColoringStyle","residueColorStyle","modelsToShowNumbers","modelsToShow","map","d","push","parseInt","objSize","window","screen","availWidth","symbolTypes","circle","symbol","type","symbolCircle","size","triangle","symbolTriangle","timeoutId","currentTime","lastTimeChanged","rsrzCount","clashes","highlightedResidues","residuesOnCanvas","lastSelection","tooltipHeight","tooltipWidth","newValue","oldValue","updateChart","chainsToShow","select","text","toUpperCase","xScale","scaleLinear","domain","range","xBottomAxis","axisBottom","xTopAxis","axisTop","xValue","xMap","tooltip","append","attr","style","yScale","yLeftAxis","axisLeft","yRightAxis","axisRight","yValue","yMap","makeYGridlines","makeXGridlines","svgContainer","classed","canvasContainer","call","tickSize","selectAll","remove","colorSelect","on","property","changeResiduesColors","addSummaryInfo","plotTypeSelect","baseContours","ramaForm","chainsString","length","chain","toString","indexOf","slice","modelsString","model","entryInfo","event","pageX","pageY","transition","duration","addEventListeners","onMouseOutResidue","onMouseOverResidue","switchPlotType","residue","aa","prePro","cisPeptide","filterModels","residues","forEach","molecule","chains","chainId","models","modelId","rama","filteredResidues","sort","residue1","residue2","num","data","enter","id","idSelector","phi","psi","merge","computeOpacity","node","opacity","clearTimeout","clickEvents","mouseOutEvents","scrollTimer","lastScrollFireTime","unHighlightObject","eventData","getResidueNode","changeObjectSize","onClick","res","console","log","pop","residueName","entityId","residueNumber","highLightObject","addEventListener","minMouseOverTime","now","Date","getTime","mouseOver","includes","setTimeout","detail","filter","authorResNum","begin","end","empty","resArrayLength","String","toFixed","undefined","drawingType","compute","computeStats","residueColor","highlightColor","dispatchCustomEvent","changeContours","html","tooltipText","tempStr","outTime","dat","resArray","jsonObject","a","b","outliersTable","sortedTable","rows","exit","cells","contourColorStyle","clearCanvas","img","Image","svgImg","src","generalContour","lineGeneralContour","ileVal","lineIleVal","linePrePro","gly","lineGly","transPro","lineTransPro","cisPro","lineCisPro","context","getContext","clearRect","globalAlpha","onload","drawImage","fillColor","changeOpacity","name","CustomEvent","entry","dispatchEvent","toDefault","getTimeout","smaller","residuesString","makeInvisible","split","nodes","reflectToAttribute","notify","observer","Array","Number","PolymerElement","customElements","define"],"mappings":"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","file":"RamachandranComponent.js","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst d3 = require(\"d3\");\r\nconst polymer_element_js_1 = require(\"@polymer/polymer/polymer-element.js\");\r\nconst HeatMapContours_1 = require(\"../contours/HeatMapContours\");\r\nconst LineContours_1 = require(\"../contours/LineContours\");\r\nrequire(\"bootstrap/dist/css/bootstrap.css\");\r\nrequire(\"../public/index.css\");\r\nconst parsePdb_1 = require(\"./parsePdb\");\r\nclass RamachandranComponent extends polymer_element_js_1.PolymerElement {\r\n    static get properties() {\r\n        return {\r\n            pdbId: {\r\n                type: String,\r\n                reflectToAttribute: true,\r\n                notify: true,\r\n                observer: '_pdbIdChanged'\r\n            },\r\n            chainsToShow: {\r\n                type: Array,\r\n                observer: '_chainsChanged',\r\n                reflectToAttribute: true,\r\n                notify: true\r\n            },\r\n            modelsToShow: {\r\n                type: Array,\r\n                observer: '_modelsChanged',\r\n                reflectToAttribute: true,\r\n                notify: true\r\n            },\r\n            width: {\r\n                type: Number,\r\n                reflectToAttribute: true\r\n            },\r\n        };\r\n    }\r\n    connectedCallback() {\r\n        super.connectedCallback();\r\n        // noinspection JSSuspiciousNameCombination\r\n        RamachandranComponent.height = this.width;\r\n        RamachandranComponent.width = this.width;\r\n        this.createChart = this.createChart.bind(this);\r\n        this.fillColorFunction = this.fillColorFunction.bind(this);\r\n        const pdb = new parsePdb_1.default(this.pdbId);\r\n        pdb.downloadAndParse();\r\n        // RamachandranComponent.jsonObject = pdb.residueArray;\r\n        RamachandranComponent.molecules = pdb.moleculs;\r\n        this.outliersType = pdb.outlDict;\r\n        this.rsrz = pdb.rsrz;\r\n        RamachandranComponent.hiddenResidues = [];\r\n        RamachandranComponent.selectedResidues = [];\r\n        this.ramachandranOutliers = 0;\r\n        this.sidechainOutliers = 0;\r\n        RamachandranComponent.favored = 0;\r\n        RamachandranComponent.allowed = 0;\r\n        RamachandranComponent.outliersList = [];\r\n        this.ramaContourPlotType = 1;\r\n        RamachandranComponent.contourColoringStyle = 1;\r\n        this.residueColorStyle = 1;\r\n        this.modelsToShowNumbers = [];\r\n        this.modelsToShow.map((d) => {\r\n            this.modelsToShowNumbers.push(parseInt(d));\r\n        });\r\n        let objSize = 40;\r\n        if (window.screen.availWidth < 1920) {\r\n            objSize = 30;\r\n        }\r\n        if (window.screen.width < 350) {\r\n            objSize = 5;\r\n        }\r\n        // symbolTypes\r\n        RamachandranComponent.symbolTypes = {\r\n            circle: d3.symbol().type(d3.symbolCircle).size(objSize),\r\n            triangle: d3.symbol().type(d3.symbolTriangle).size(objSize)\r\n        };\r\n        RamachandranComponent.timeoutId = 0;\r\n        RamachandranComponent.currentTime = 0;\r\n        RamachandranComponent.lastTimeChanged = 0;\r\n        this.rsrzCount = 0;\r\n        this.clashes = 0;\r\n        RamachandranComponent.highlightedResidues = [];\r\n        RamachandranComponent.residuesOnCanvas = [];\r\n        this.createChart();\r\n        this.lastSelection = {};\r\n        RamachandranComponent.tooltipHeight = 58;\r\n        RamachandranComponent.tooltipWidth = 90;\r\n    }\r\n    _pdbIdChanged(newValue, oldValue) {\r\n        if (typeof oldValue == 'undefined')\r\n            return;\r\n        const pdb = new parsePdb_1.default(this.pdbId);\r\n        pdb.downloadAndParse();\r\n        RamachandranComponent.molecules = pdb.moleculs;\r\n        this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShow);\r\n        d3.select('#rama-info-pdbid').text(this.pdbId.toUpperCase());\r\n    }\r\n    _chainsChanged(newValue, oldValue) {\r\n        if (typeof oldValue == 'undefined')\r\n            return;\r\n        this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShow);\r\n        d3.select('#rama-info-chains').text(this.chainsToShow);\r\n    }\r\n    _modelsChanged(newValue, oldValue) {\r\n        if (typeof oldValue == 'undefined')\r\n            return;\r\n        this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShow);\r\n        d3.select('#rama-info-models').text(this.modelsToShow);\r\n    }\r\n    /**\r\n     * creates basic chart, add axes, creates tooltip\r\n     */\r\n    createChart() {\r\n        let width = RamachandranComponent.width, height = RamachandranComponent.height;\r\n        if (typeof width == 'undefined') {\r\n            RamachandranComponent.width = 500;\r\n            width = 500;\r\n        }\r\n        if (typeof height == 'undefined') {\r\n            RamachandranComponent.height = 500;\r\n            height = 500;\r\n        }\r\n        // setup x\r\n        const xScale = d3.scaleLinear()\r\n            .domain([-180, 180])\r\n            .range([0, (width)]);\r\n        let xBottomAxis = d3.axisBottom(xScale);\r\n        let xTopAxis = d3.axisTop(xScale);\r\n        const xValue = (d) => d['phi'];\r\n        this.xMap = (d) => xScale(xValue(d));\r\n        // tooltip\r\n        this.tooltip = d3.select('body').append('div')\r\n            .attr('class', 'rama-tooltip')\r\n            .attr('height', 0)\r\n            .style('opacity', 0);\r\n        // setup y\r\n        const yScale = d3.scaleLinear()\r\n            .domain([180, -180])\r\n            .range([0, (height)]);\r\n        let yLeftAxis = d3.axisLeft(yScale);\r\n        let yRightAxis = d3.axisRight(yScale);\r\n        const yValue = (d) => d['psi'];\r\n        this.yMap = (d) => yScale(yValue(d));\r\n        function makeYGridlines() {\r\n            return d3.axisRight(yScale);\r\n        }\r\n        function makeXGridlines() {\r\n            return d3.axisTop(xScale);\r\n        }\r\n        //\r\n        this.svgContainer = d3.select('ramachandran-component').append('div')\r\n            .attr('id', 'rama-svg-container')\r\n            .style('max-width', `${width}px`)\r\n            .style('width', '100%')\r\n            .append('svg')\r\n            .classed('svg-container', true)\r\n            .attr('id', 'rama-svg')\r\n            .style('max-width', `${width}px`)\r\n            .style('width', '100%')\r\n            .style('padding', '30px 30px 30px 50px')\r\n            .attr('preserveAspectRatio', 'xMinYMin meet')\r\n            .attr('viewBox', `0 0 ${width} ${height}`)\r\n            .classed('svg-content-responsive', true)\r\n            .style('overflow', 'visible');\r\n        RamachandranComponent.canvasContainer = d3.select('#rama-svg-container')\r\n            .append('canvas')\r\n            .classed('img-responsive', true)\r\n            .attr('id', 'rama-canvas')\r\n            .attr('width', width)\r\n            .style('max-width', `${width - 90}px`)\r\n            .attr('height', height)\r\n            .classed('svg-content-responsive', true)\r\n            .attr('preserveAspectRatio', 'xMinYMin meet')\r\n            .attr('viewBox', `0 0 ${width} ${height}`)\r\n            .style('overflow', 'visible');\r\n        // // add axes\r\n        this.svgContainer.append('g')\r\n            .call(xTopAxis)\r\n            .attr('id', 'x-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('transform', `translate(0, ${height})`)\r\n            .call(xBottomAxis)\r\n            .attr('id', 'x-axis');\r\n        this.svgContainer.append('g')\r\n            .call(yLeftAxis)\r\n            .attr('id', 'y-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('transform', () => `translate(${width}, 0)`)\r\n            .call(yRightAxis)\r\n            .attr('id', 'y-axis');\r\n        this.svgContainer.append('g')\r\n            .attr('class', 'rama-grid')\r\n            .attr('transform', `translate(0, ${height})`)\r\n            .call(makeXGridlines()\r\n            .tickSize(width));\r\n        this.svgContainer.append('g')\r\n            .attr('class', 'rama-grid')\r\n            .call(makeYGridlines()\r\n            .tickSize(height));\r\n        // axis labels\r\n        // phi label\r\n        this.svgContainer.append('text')\r\n            .attr('x', width / 2)\r\n            .attr('y', height + 35)\r\n            .style('text-anchor', 'middle')\r\n            .style('fill', '#000')\r\n            .text('\\u03A6');\r\n        // psi label\r\n        this.svgContainer.append('text')\r\n            .attr('x', 0 - (height / 2))\r\n            .attr('y', -35)\r\n            .style('text-anchor', 'middle')\r\n            .style('fill', '#000')\r\n            .attr('transform', 'rotate(-90)')\r\n            .text('\\u03A8');\r\n        //\r\n        // // outliers headline\r\n        // d3.select('#rama-root').append('div')\r\n        //     .attr('class', 'rama-outliers-div')\r\n        //     .append('div')\r\n        //     .attr('class', 'rama-outliers-headline')\r\n        //     .append('h4')\r\n        //     .text('OUTLIERS');\r\n        //\r\n        // d3.select('.rama-outliers-div').append('div')\r\n        //     .attr('class', 'outliers-container');\r\n        d3.selectAll('g.rama-grid g.tick text').remove();\r\n        d3.select('#rama-svg-container').append('div').attr('id', 'rama-sum').attr('class', 'rama-set-cl');\r\n        d3.select('#rama-svg-container').append('div').attr('id', 'rama-settings').attr('class', 'rama-set-cl');\r\n        let colorSelect = d3.select('#rama-settings').append('select').attr('id', 'rama-coloring');\r\n        colorSelect.append('option').attr('value', 1).text('Default');\r\n        colorSelect.append('option').attr('value', 2).text('Quality');\r\n        colorSelect.append('option').attr('value', 3).text('RSRZ');\r\n        colorSelect.on('change', () => {\r\n            this.residueColorStyle = parseInt(d3.select('#rama-coloring').property('value'));\r\n            this.changeResiduesColors(this.residueColorStyle);\r\n            this.addSummaryInfo();\r\n        });\r\n        let plotTypeSelect = d3.select('#rama-settings').append('select').attr('id', 'rama-plot-type');\r\n        plotTypeSelect.append('option').attr('value', 1).text('General case');\r\n        plotTypeSelect.append('option').attr('value', 2).text('Isoleucine and valine');\r\n        plotTypeSelect.append('option').attr('value', 3).text('Pre-proline');\r\n        plotTypeSelect.append('option').attr('value', 4).text('Glycine');\r\n        plotTypeSelect.append('option').attr('value', 5).text('Trans proline');\r\n        plotTypeSelect.append('option').attr('value', 6).text('Cis proline');\r\n        plotTypeSelect.on('change', () => {\r\n            this.ramaContourPlotType = parseInt(d3.select('#rama-plot-type').property('value'));\r\n            this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShowNumbers);\r\n            RamachandranComponent.baseContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n        });\r\n        let ramaForm = d3.select('#rama-settings').append('form').attr('id', 'rama-contour-style');\r\n        ramaForm.append('label').classed('rama-contour-style', true).text('Contour').append('input')\r\n            .attr('type', 'radio')\r\n            .attr('name', 'contour-style')\r\n            .attr('value', 1)\r\n            .attr('checked', true)\r\n            .classed('rama-contour-radio', true);\r\n        ramaForm.append('label').classed('rama-contour-style', true).text('Heat Map').append('input')\r\n            .attr('type', 'radio')\r\n            .attr('name', 'contour-style')\r\n            .attr('value', 2)\r\n            .classed('rama-contour-radio', true);\r\n        ramaForm.on('change', () => {\r\n            RamachandranComponent.contourColoringStyle = parseInt(d3.select('input[name=\"contour-style\"]:checked').property('value'));\r\n            RamachandranComponent.baseContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n        });\r\n        let chainsString = '';\r\n        if (this.chainsToShow.length > 2) {\r\n            for (const chain of this.chainsToShow) {\r\n                chainsString += chain.toString() + ', ';\r\n                if (this.chainsToShow.indexOf(chain) == this.chainsToShow.length - 1)\r\n                    chainsString.slice(0, -2);\r\n                if (this.chainsToShow.indexOf(chain) == 2) {\r\n                    chainsString += '...';\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else\r\n            chainsString = this.chainsToShow.toString();\r\n        let modelsString = '';\r\n        if (this.modelsToShow.length > 2) {\r\n            for (const model of this.modelsToShow) {\r\n                modelsString += model.toString() + ', ';\r\n                if (this.modelsToShow.indexOf(model) == this.modelsToShow.length - 1)\r\n                    modelsString.slice(0, -2);\r\n                if (this.modelsToShow.indexOf(model) == 2) {\r\n                    modelsString += '...';\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else\r\n            modelsString = this.modelsToShow.toString();\r\n        let tooltip = d3.select(\"body\")\r\n            .append(\"div\")\r\n            .style(\"position\", \"absolute\")\r\n            .style(\"z-index\", \"10\")\r\n            .style(\"visibility\", \"hidden\");\r\n        let entryInfo = d3.select('#rama-settings').append('div').style('display', 'inline-block')\r\n            .style('width', '27%').style('margin', '5px 5px 5px 10px');\r\n        entryInfo.append('div').style('display', 'inline-block').style('width', '28%')\r\n            .attr('id', 'rama-info-pdbid').text(this.pdbId.toUpperCase());\r\n        entryInfo.append('div').style('display', 'inline-block')\r\n            .attr('id', 'rama-info-chains').style('width', '36%')\r\n            .style('text-align', 'right').text(chainsString);\r\n        d3.select('#rama-info-chains').on(\"mouseover\", () => {\r\n            d3.select('#rama-info-chains').style('cursor', 'default');\r\n            return tooltip.style(\"visibility\", \"visible\")\r\n                .style('opacity', .95)\r\n                .text(this.chainsToShow)\r\n                .style('left', (d3.event.pageX + 10) + 'px')\r\n                .style('top', (d3.event.pageY - 48) + 'px')\r\n                .style('background', 'gray')\r\n                .style('padding', '2px 5px 2px 5px')\r\n                .transition().duration(50);\r\n        })\r\n            .on(\"mouseout\", () => { return tooltip.style(\"visibility\", \"hidden\"); });\r\n        entryInfo.append('div').style('display', 'inline-block').attr('id', 'rama-info-models')\r\n            .style('width', '36%').style('text-align', 'right').text(modelsString);\r\n        d3.select('#rama-info-models').on(\"mouseover\", () => {\r\n            d3.select('#rama-info-models').style('cursor', 'default');\r\n            return tooltip.style(\"visibility\", \"visible\")\r\n                .text(this.modelsToShow.toString())\r\n                .style('opacity', .95)\r\n                .style('left', (d3.event.pageX + 10) + 'px')\r\n                .style('top', (d3.event.pageY - 48) + 'px')\r\n                .style('background', 'gray')\r\n                .style('padding', '2px 5px 2px 5px')\r\n                .transition().duration(50);\r\n        })\r\n            .on(\"mouseout\", () => { return tooltip.style(\"visibility\", \"hidden\"); });\r\n        this.updateChart(this.chainsToShow, this.ramaContourPlotType, this.modelsToShowNumbers);\r\n        RamachandranComponent.baseContours(this.ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n        this.addEventListeners();\r\n        d3.select('#rama-canvas')\r\n            .style('max-width', `${width}px`)\r\n            .style('width', '100.5%')\r\n            .style('padding', '30px 30px 30px 50px');\r\n    }\r\n    /**\r\n     * change residues in chart\r\n     * @param {String[]} chainsToShow\r\n     * @param {number} ramaContourPlotType\r\n     * @param {number[]} modelsToShow\r\n     */\r\n    updateChart(chainsToShow, ramaContourPlotType, modelsToShow) {\r\n        this.svgContainer.selectAll('g.dataGroup').remove();\r\n        //reset counters\r\n        this.sidechainOutliers = 0;\r\n        this.rsrzCount = 0;\r\n        this.ramachandranOutliers = 0;\r\n        RamachandranComponent.allowed = 0;\r\n        RamachandranComponent.favored = 0;\r\n        this.clashes = 0;\r\n        RamachandranComponent.residuesOnCanvas = [];\r\n        RamachandranComponent.outliersList = [];\r\n        // let width = 500;\r\n        const { fillColorFunction, outliersType, rsrz, tooltip, residueColorStyle, width } = this;\r\n        let { onMouseOutResidue, onMouseOverResidue } = this;\r\n        const pdbId = this.pdbId;\r\n        // scales\r\n        const xScale = d3.scaleLinear()\r\n            .domain([-180, 180])\r\n            .range([0, (width)]);\r\n        // .range([0, (0.985 * width)]);\r\n        const yScale = d3.scaleLinear()\r\n            .domain([180, -180])\r\n            .range([0, (width)]);\r\n        /**\r\n         * determines which residues will be displayed depending on ramaContourPlotType\r\n         * @param residue\r\n         * @returns {Residue}\r\n         */\r\n        function switchPlotType(residue) {\r\n            switch (ramaContourPlotType) {\r\n                case 1:\r\n                    return residue;\r\n                case 2:\r\n                    if (residue.aa == 'ILE' || residue.aa == 'VAL') {\r\n                        return residue;\r\n                    }\r\n                    break;\r\n                case 3:\r\n                    if (residue.prePro)\r\n                        return residue;\r\n                    break;\r\n                case 4:\r\n                    if (residue.aa == 'GLY') {\r\n                        return residue;\r\n                    }\r\n                    break;\r\n                case 5:\r\n                    if (residue.cisPeptide == null && residue.aa == 'PRO') {\r\n                        return residue;\r\n                    }\r\n                    break;\r\n                case 6:\r\n                    if (residue.cisPeptide == 'Y' && residue.aa == 'PRO') {\r\n                        return residue;\r\n                    }\r\n                    break;\r\n                default:\r\n                    return residue;\r\n            }\r\n        }\r\n        // let residues = [];\r\n        // filteredMolecules().forEach((molecule: any) => {\r\n        //     molecule.chains.forEach((chain: any) => {\r\n        //         chain.models.forEach((model: any) => {\r\n        //             model.residues.forEach((residue: any) => {\r\n        //                 switch (ramaContourPlotType) {\r\n        //                     case 1:\r\n        //                         residues.push(residue);\r\n        //                         break;\r\n        //                     case 2:\r\n        //                         if (residue.aa == 'ILE' || residue.aa == 'VAL') {\r\n        //                             residues.push(residue);\r\n        //                         }\r\n        //                         break;\r\n        //                     case 3:\r\n        //                         if (residue.prePro)\r\n        //                             residues.push(residue);\r\n        //                         break;\r\n        //                     case 4:\r\n        //                         if (residue.aa == 'GLY') {\r\n        //                             residues.push(residue);\r\n        //                         }\r\n        //                         break;\r\n        //                     case 5:\r\n        //                         if (residue.cisPeptide == null && residue.aa == 'PRO') {\r\n        //                             residues.push(residue);\r\n        //                         }\r\n        //                         break;\r\n        //                     case 6:\r\n        //                         if (residue.cisPeptide == 'Y' && residue.aa == 'PRO') {\r\n        //                             residues.push(residue);\r\n        //                         }\r\n        //                         break;\r\n        //                     default:\r\n        //                         residues.push(residue);\r\n        //                 }\r\n        //             })\r\n        //         })\r\n        //     })\r\n        // });\r\n        // sort because of svg z-index\r\n        // outliersText\r\n        d3.selectAll('.outliers').remove();\r\n        d3.selectAll('table').remove();\r\n        function filterModels() {\r\n            let residues = [];\r\n            RamachandranComponent.molecules.forEach((molecule) => {\r\n                molecule.chains.forEach((chain) => {\r\n                    if (chainsToShow.indexOf(chain.chainId) != -1) {\r\n                        chain.models.forEach((model) => {\r\n                            if (modelsToShow.indexOf(model.modelId) != -1) {\r\n                                model.residues.forEach((residue) => {\r\n                                    residue.modelId = model.modelId;\r\n                                    residue.chainId = chain.chainId;\r\n                                    if (switchPlotType(residue) && residue.rama != null) {\r\n                                        RamachandranComponent.residuesOnCanvas.push(residue);\r\n                                        residues.push(residue);\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            return residues;\r\n        }\r\n        let filteredResidues = filterModels().sort((residue1, residue2) => {\r\n            if (typeof rsrz[residue1.num] != 'undefined') {\r\n                return 1;\r\n            }\r\n            else if (typeof rsrz[residue2.num] != 'undefined') {\r\n                return -1;\r\n            }\r\n            else if (typeof outliersType[residue1.num] == 'undefined') {\r\n                return -1;\r\n            }\r\n            else if (typeof outliersType[residue2.num] == 'undefined') {\r\n                return 1;\r\n            }\r\n            else if (outliersType[residue1.num].outliersType.length > outliersType[residue2.num].outliersType.length) {\r\n                return 1;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        });\r\n        this.svgContainer.selectAll('.shapes')\r\n            .data(filteredResidues)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', 'dataGroup')\r\n            .append('path')\r\n            .attr('id', (residue) => {\r\n            const id = residue.aa + '-' + residue.chainId + '-' + residue.modelId + '-' + residue.num;\r\n            residue.idSelector = id;\r\n            if (residueColorStyle !== 3) {\r\n                if (residue.rama === 'OUTLIER') {\r\n                    RamachandranComponent.outliersList.push(residue);\r\n                }\r\n                if (residue.rama === 'Favored') {\r\n                    RamachandranComponent.favored++;\r\n                }\r\n                if (residue.rama === 'Allowed') {\r\n                    RamachandranComponent.allowed++;\r\n                }\r\n                return id;\r\n            }\r\n            if (residue.rama === 'OUTLIER' && typeof rsrz[residue.num] !== 'undefined') {\r\n                RamachandranComponent.outliersList.push(residue);\r\n                return id;\r\n            }\r\n            return id;\r\n        })\r\n            .attr('d', (residue) => {\r\n            if (residue.aa === 'GLY') {\r\n                return RamachandranComponent.symbolTypes.triangle();\r\n            }\r\n            return RamachandranComponent.symbolTypes.circle();\r\n        })\r\n            .attr('transform', (residue) => 'translate(' + xScale(residue.phi) + ',' + yScale(residue.psi) + ')')\r\n            .merge(this.svgContainer)\r\n            // .style('fill', 'transparent')\r\n            .style('fill', (residue) => fillColorFunction(residue, residueColorStyle, outliersType, rsrz, true))\r\n            // .style('stroke', 'rgb(144, 142, 123)')\r\n            .style('opacity', (residue) => {\r\n            return RamachandranComponent.computeOpacity(fillColorFunction(residue, residueColorStyle, outliersType, rsrz));\r\n        })\r\n            .on('mouseover', function (node) {\r\n            if (d3.select(this).node().style.opacity == 0)\r\n                return;\r\n            onMouseOverResidue(node, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz);\r\n        })\r\n            .on('mouseout', function (node) {\r\n            if (d3.select(this).node().style.opacity == 0)\r\n                return;\r\n            window.clearTimeout(RamachandranComponent.timeoutId);\r\n            onMouseOutResidue(node, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz);\r\n        });\r\n        // .on('click', function(d: any) {\r\n        //     if (highlightedResidues.length != 0) {\r\n        //         highlightedResidues.forEach((d: any) => {\r\n        //             d3.select('#' + d.idSelector)\r\n        //                 .attr('d', (d: any) => changeObjectSize(d)).transition().duration(50)\r\n        //                 .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz))\r\n        //                 .style('opacity', (d) => {\r\n        //                     return RamachandranComponent.computeOpacity(fillColorFunction(d, drawingType, outliersType, rsrz))\r\n        //                 });\r\n        //         });\r\n        //         highlightedResidues.pop();\r\n        //     }\r\n        //     dispatchCustomEvent('PDB.ramaViewer.click', d);\r\n        //     highlightedResidues.push(d);\r\n        //     d3.select(this)\r\n        //         .attr('d', (d: any) => changeObjectSize(d, false))\r\n        //         .style('fill', 'magenta')\r\n        //         .style('opacity', 1);\r\n        //         // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n        // });\r\n        RamachandranComponent.outliersList.sort((residue1, residue2) => residue1.num - residue2.num);\r\n        this.addSummaryInfo();\r\n    }\r\n    /**\r\n     * add baseContours\r\n     * @param {number} ramaContourPlotType\r\n     * @param {number} contourColorStyle\r\n     */\r\n    static baseContours(ramaContourPlotType, contourColorStyle) {\r\n        RamachandranComponent.clearCanvas();\r\n        let width = RamachandranComponent.width, height = RamachandranComponent.height;\r\n        const img = new Image();\r\n        const svgImg = new Image();\r\n        switch (ramaContourPlotType) {\r\n            case 1:\r\n                img.src = HeatMapContours_1.generalContour;\r\n                svgImg.src = LineContours_1.lineGeneralContour;\r\n                break;\r\n            case 2:\r\n                img.src = HeatMapContours_1.ileVal;\r\n                svgImg.src = LineContours_1.lineIleVal;\r\n                break;\r\n            case 3:\r\n                img.src = HeatMapContours_1.prePro;\r\n                svgImg.src = LineContours_1.linePrePro;\r\n                break;\r\n            case 4:\r\n                img.src = HeatMapContours_1.gly;\r\n                svgImg.src = LineContours_1.lineGly;\r\n                break;\r\n            case 5:\r\n                img.src = HeatMapContours_1.transPro;\r\n                svgImg.src = LineContours_1.lineTransPro;\r\n                break;\r\n            case 6:\r\n                img.src = HeatMapContours_1.cisPro;\r\n                svgImg.src = LineContours_1.lineCisPro;\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        const context = RamachandranComponent.canvasContainer.node().getContext('2d');\r\n        context.clearRect(0, 0, width + 80, height + 60);\r\n        if (contourColorStyle == 2) {\r\n            context.globalAlpha = 0.6;\r\n            img.onload = () => {\r\n                context.drawImage(img, 0, 0, width, height * img.height / img.width);\r\n            };\r\n        }\r\n        else {\r\n            context.globalAlpha = 1;\r\n            svgImg.onload = () => {\r\n                context.drawImage(svgImg, 0, 0, width, height * svgImg.height / svgImg.width);\r\n            };\r\n        }\r\n    }\r\n    /**\r\n     * add listeners from other components\r\n     */\r\n    addEventListeners() {\r\n        const clickEvents = ['PDB.litemol.click', 'PDB.topologyViewer.click'];\r\n        const mouseOutEvents = ['PDB.topologyViewer.mouseout', 'PDB.litemol.mouseout'];\r\n        let scrollTimer, lastScrollFireTime = 0;\r\n        const { fillColorFunction, residueColorStyle, outliersType, rsrz } = this;\r\n        /**\r\n         * unhighlight residue from event\r\n         * @param event\r\n         */\r\n        function unHighlightObject(event) {\r\n            if (typeof event.eventData != 'undefined') {\r\n                if (RamachandranComponent.highlightedResidues.indexOf(getResidueNode(event)) == -1) {\r\n                    d3.select('.selected-res')\r\n                        .classed('selected-res', false)\r\n                        .attr('d', (residue) => RamachandranComponent.changeObjectSize(residue)).transition().duration(50)\r\n                        .style('fill', (residue) => fillColorFunction(residue, residueColorStyle, outliersType, rsrz, true))\r\n                        .style('display', 'block');\r\n                    // .style('opacity', (d) => {\r\n                    //     return RamachandranComponent.computeOpacity(fillColorFunction(d, drawingType, outliersType, rsrz))\r\n                    // });\r\n                }\r\n            }\r\n        }\r\n        /**\r\n         * onClick event\r\n         * @param event\r\n         */\r\n        function onClick(event) {\r\n            const res = getResidueNode(event);\r\n            if (RamachandranComponent.highlightedResidues.length != 0) {\r\n                RamachandranComponent.highlightedResidues.forEach((node) => {\r\n                    console.log(typeof node);\r\n                    node.attr('d', (residue) => RamachandranComponent.changeObjectSize(residue)).transition().duration(50)\r\n                        .style('fill', (residue) => fillColorFunction(residue, residueColorStyle, outliersType, rsrz))\r\n                        .style('display', 'block');\r\n                    // .style('opacity', (d) => {\r\n                    //     return RamachandranComponent.computeOpacity(fillColorFunction(d, drawingType, outliersType, rsrz))\r\n                    // });\r\n                });\r\n                RamachandranComponent.highlightedResidues.pop();\r\n            }\r\n            RamachandranComponent.highlightedResidues.push(res);\r\n            getResidueNode(event).attr('d', (residue) => RamachandranComponent.changeObjectSize(residue, false))\r\n                .classed('selected-res', false)\r\n                .style('fill', 'magenta')\r\n                .style('opacity', '1');\r\n        }\r\n        /**\r\n         * return residue node from event\r\n         * @param event\r\n         * @returns {Selection}\r\n         */\r\n        function getResidueNode(event) {\r\n            if (typeof event.eventData.chainId == 'undefined')\r\n                return null;\r\n            return d3.select('path#' +\r\n                event.eventData.residueName + '-' +\r\n                event.eventData.chainId + '-' +\r\n                event.eventData.entityId + '-' +\r\n                event.eventData.residueNumber);\r\n        }\r\n        /**\r\n         * highlight residue from event\r\n         * @param event\r\n         */\r\n        function highLightObject(event) {\r\n            let res = getResidueNode(event);\r\n            if (res) {\r\n                res.attr('d', (d) => RamachandranComponent.changeObjectSize(d, false))\r\n                    .classed('selected-res', true)\r\n                    .style('fill', 'yellow')\r\n                    .style('opacity', '1');\r\n                // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n            }\r\n        }\r\n        window.addEventListener('PDB.topologyViewer.mouseover', (event) => {\r\n            const minMouseOverTime = 150;\r\n            let now = new Date().getTime();\r\n            function mouseOver(event) {\r\n                if (typeof event.eventData != 'undefined') {\r\n                    let res = getResidueNode(event);\r\n                    if (res) {\r\n                        if (res.attr('style').includes('magenta')) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    unHighlightObject(event);\r\n                    highLightObject(event);\r\n                }\r\n                else {\r\n                    unHighlightObject(event);\r\n                }\r\n            }\r\n            if (!scrollTimer) {\r\n                if (now - lastScrollFireTime > (3 * minMouseOverTime)) {\r\n                    mouseOver(event); // fire immediately on first scroll\r\n                    lastScrollFireTime = now;\r\n                }\r\n                scrollTimer = setTimeout(function () {\r\n                    scrollTimer = null;\r\n                    lastScrollFireTime = new Date().getTime();\r\n                    mouseOver(event);\r\n                }, minMouseOverTime);\r\n            }\r\n        });\r\n        window.addEventListener('PDB.litemol.mouseover', (event) => {\r\n            if (typeof event.eventData != 'undefined') {\r\n                let res = getResidueNode(event);\r\n                if (res) {\r\n                    if (res.attr('style').includes('magenta')) {\r\n                        return;\r\n                    }\r\n                }\r\n                unHighlightObject(event);\r\n                highLightObject(event);\r\n            }\r\n            else {\r\n                unHighlightObject(event);\r\n            }\r\n        });\r\n        window.addEventListener('protvista.click', (d) => {\r\n            RamachandranComponent.hiddenResidues.forEach((residue) => {\r\n                if (residue.idSelector != '') {\r\n                    d3.select(`#${residue.idSelector}`)\r\n                        .style('visibility', 'visible');\r\n                }\r\n            });\r\n            if (this.lastSelection == d.detail) {\r\n                RamachandranComponent.hiddenResidues = [];\r\n                RamachandranComponent.selectedResidues = [];\r\n                this.lastSelection = {};\r\n                return;\r\n            }\r\n            this.lastSelection = d.detail;\r\n            RamachandranComponent.hiddenResidues = RamachandranComponent.residuesOnCanvas.filter((residue) => {\r\n                if (!(residue.authorResNum >= this.lastSelection.begin && residue.authorResNum <= this.lastSelection.end))\r\n                    return residue;\r\n                else\r\n                    RamachandranComponent.selectedResidues.push(residue);\r\n            });\r\n            RamachandranComponent.hiddenResidues.forEach((residue) => {\r\n                if (residue.idSelector != '') {\r\n                    if (d3.select(`#${residue.idSelector}`).empty()) {\r\n                        return;\r\n                    }\r\n                    d3.select(`#${residue.idSelector}`).style('visibility', 'hidden');\r\n                }\r\n            });\r\n        });\r\n        /**\r\n         * add event listeners\r\n         */\r\n        clickEvents.forEach((type) => {\r\n            window.addEventListener(type, (event) => {\r\n                onClick(event);\r\n            });\r\n        });\r\n        mouseOutEvents.forEach((type) => {\r\n            window.addEventListener(type, (event) => {\r\n                if (RamachandranComponent.highlightedResidues.indexOf(event) > -1) {\r\n                    return;\r\n                }\r\n                unHighlightObject(event);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * add summary infobelow the plot\r\n     */\r\n    addSummaryInfo() {\r\n        let resArrayLength = RamachandranComponent.residuesOnCanvas.length;\r\n        if (RamachandranComponent.residuesOnCanvas.length == 0)\r\n            resArrayLength = 1;\r\n        switch (this.residueColorStyle) {\r\n            case 1:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('Preferred regions: ' + String(RamachandranComponent.favored)\r\n                    + ' (' + String((RamachandranComponent.favored / resArrayLength * 100).toFixed(0))\r\n                    + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-middle')\r\n                    .text('Allowed regions: ' + String(RamachandranComponent.allowed)\r\n                    + ' (' + String((RamachandranComponent.allowed / resArrayLength * 100).toFixed(0))\r\n                    + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-thinnest')\r\n                    .text('Outliers: ' + String(RamachandranComponent.outliersList.length)\r\n                    + ' (' + String((RamachandranComponent.outliersList.length / resArrayLength * 100).toFixed(0)) + '%)').enter();\r\n                break;\r\n            case 2:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('Ramachandran outliers: ' + String(this.ramachandranOutliers)\r\n                    + ' (' + String((this.ramachandranOutliers / resArrayLength * 100).toFixed(0)) +\r\n                    '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-middle')\r\n                    .text('Sidechain outliers: ' + String(this.sidechainOutliers)\r\n                    + ' (' + String((this.sidechainOutliers / resArrayLength * 100).toFixed(0)) + '%)').enter();\r\n                d3.select('#rama-sum-div').append('div').attr('class', 'rama-sum-cell')\r\n                    .attr('id', 'rama-sum-thinnest')\r\n                    .text('Clashes: ' + String(this.clashes)\r\n                    + ' (' + String((this.clashes / resArrayLength * 100).toFixed(0)) + '%)').enter();\r\n                break;\r\n            case 3:\r\n                d3.selectAll('#rama-sum-div').remove();\r\n                d3.select('#rama-sum').append('div').attr('id', 'rama-sum-div')\r\n                    .append('div').attr('class', 'rama-sum-cell').attr('id', 'rama-sum-widest')\r\n                    .text('RSRZ: ' + String(this.rsrzCount)\r\n                    + ' (' + String((this.rsrzCount / resArrayLength * 100).toFixed(0)) + '%) ').enter();\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n    }\r\n    /**\r\n     * compute summary stats of ramachandran diagram\r\n     * @param residue\r\n     */\r\n    computeStats(residue) {\r\n        if (this.outliersType[residue.num] != undefined) {\r\n            if (this.outliersType[residue.num].outliersType.includes('clashes')) {\r\n                this.clashes++;\r\n            }\r\n            if (this.outliersType[residue.num].outliersType.includes('ramachandran_outliers')) {\r\n                this.ramachandranOutliers++;\r\n            }\r\n            if (this.outliersType[residue.num].outliersType.includes('sidechain_outliers')) {\r\n                this.sidechainOutliers++;\r\n            }\r\n        }\r\n        if (typeof this.rsrz[residue.num] != 'undefined') {\r\n            this.rsrzCount++;\r\n        }\r\n    }\r\n    /**\r\n     * return fillColor which will be used\r\n     * @param residue - one residue\r\n     * @param {number} drawingType Default - 1/Quality - 2/ RSRZ - 3\r\n     * @param outliersType\r\n     * @param rsrz\r\n     * @param {boolean} compute\r\n     * @returns {string} hex of color\r\n     */\r\n    fillColorFunction(residue, drawingType, outliersType, rsrz, compute = false) {\r\n        if (compute)\r\n            this.computeStats(residue);\r\n        switch (drawingType) {\r\n            case 1:\r\n                if (residue.rama === 'OUTLIER') {\r\n                    residue.residueColor = '#f00';\r\n                    return residue.residueColor;\r\n                }\r\n                residue.residueColor = '#000';\r\n                return residue.residueColor;\r\n            case 2:\r\n                if (typeof outliersType[residue.num] === 'undefined') {\r\n                    residue.residueColor = '#008000';\r\n                    return residue.residueColor;\r\n                }\r\n                else {\r\n                    switch (outliersType[residue.num].outliersType.length) {\r\n                        case 0:\r\n                            residue.residueColor = '#008000';\r\n                            return residue.residueColor;\r\n                        case 1:\r\n                            residue.residueColor = '#ff0';\r\n                            return residue.residueColor;\r\n                        case 2:\r\n                            residue.residueColor = '#f80';\r\n                            return residue.residueColor;\r\n                        default:\r\n                            residue.residueColor = '#850013';\r\n                            return residue.residueColor;\r\n                    }\r\n                }\r\n            case 3:\r\n                if (typeof rsrz[residue.num] === 'undefined') {\r\n                    residue.residueColor = '#000';\r\n                    return residue.residueColor;\r\n                }\r\n                else {\r\n                    residue.residueColor = '#f00';\r\n                    return residue.residueColor;\r\n                }\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     * how opaque node will be\r\n     * @param fillColor\r\n     * @returns {number}\r\n     */\r\n    static computeOpacity(fillColor) {\r\n        if (fillColor == '#008000')\r\n            return 0.5;\r\n        if (fillColor == 'black' || fillColor == '#000')\r\n            return 0.15;\r\n        if (fillColor == '#ff0')\r\n            return 0.8;\r\n        return 1;\r\n    }\r\n    /**\r\n     * return timeoutid when hovering\r\n     * @param {number} ramaContourPlotType\r\n     * @param {string} aa\r\n     * @returns {number}\r\n     */\r\n    static getTimeout(ramaContourPlotType, aa = '') {\r\n        return window.setTimeout(() => {\r\n            RamachandranComponent.baseContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n            RamachandranComponent.changeOpacity(aa);\r\n        }, 600);\r\n    }\r\n    /**\r\n     * throw new event with defined data\r\n     * @param {string} name name of event\r\n     * @param {string} pdbId\r\n     * @param residue node\r\n     */\r\n    static dispatchCustomEvent(name, residue, pdbId) {\r\n        const event = new CustomEvent(name, { detail: {\r\n                chainId: residue.chainId,\r\n                entityId: residue.modelId,\r\n                entry: pdbId,\r\n                residueName: residue.aa,\r\n                residueNumber: residue.num\r\n            } });\r\n        window.dispatchEvent(event);\r\n    }\r\n    /**\r\n     * function for change contours after mouseout or mouseover\r\n     * @param residue selected node\r\n     * @param toDefault true if used for return to base state\r\n     * @param ramaContourPlotType\r\n     */\r\n    static changeContours(residue, toDefault = true, ramaContourPlotType) {\r\n        RamachandranComponent.currentTime = new Date().getTime();\r\n        switch (residue.aa) {\r\n            case 'ILE':\r\n            case 'VAL':\r\n                if (ramaContourPlotType != 2) {\r\n                    if (toDefault) {\r\n                        RamachandranComponent.baseContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                        RamachandranComponent.changeOpacity('VAL,ILE', false);\r\n                    }\r\n                    else {\r\n                        RamachandranComponent.timeoutId = RamachandranComponent.getTimeout(2, 'VAL,ILE');\r\n                    }\r\n                }\r\n                return;\r\n            case 'GLY':\r\n                if (ramaContourPlotType != 4) {\r\n                    if (toDefault) {\r\n                        RamachandranComponent.baseContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                        RamachandranComponent.changeOpacity('GLY', false);\r\n                    }\r\n                    else {\r\n                        RamachandranComponent.timeoutId = RamachandranComponent.getTimeout(4, 'GLY');\r\n                    }\r\n                }\r\n                return;\r\n            case 'PRO':\r\n                if (ramaContourPlotType < 5) {\r\n                    if (toDefault) {\r\n                        RamachandranComponent.baseContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                        RamachandranComponent.changeOpacity('PRO', false);\r\n                    }\r\n                    else {\r\n                        if (residue.cisPeptide === null && residue.aa === 'PRO') {\r\n                            RamachandranComponent.timeoutId = RamachandranComponent.getTimeout(5, 'PRO');\r\n                            break;\r\n                        }\r\n                        if (residue.cisPeptide === 'Y' && residue.aa === 'PRO') {\r\n                            RamachandranComponent.timeoutId = RamachandranComponent.getTimeout(6, 'PRO');\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                return;\r\n            default:\r\n                break;\r\n        }\r\n        if (residue.prePro) {\r\n            if (ramaContourPlotType != 3) {\r\n                if (toDefault) {\r\n                    RamachandranComponent.baseContours(ramaContourPlotType, RamachandranComponent.contourColoringStyle);\r\n                    RamachandranComponent.changeOpacity('', false);\r\n                }\r\n                else {\r\n                    RamachandranComponent.timeoutId = RamachandranComponent.getTimeout(3, '');\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * text for tooltip\r\n     * @param residue\r\n     * @returns {string}\r\n     */\r\n    static tooltipText(residue) {\r\n        // language=HTML\r\n        return `<b>${residue.chainId} ${residue.num} ${residue.aa}</b><br/>\\u03A6: ${residue.phi}<br/>\\u03A8: ${residue.psi}`;\r\n    }\r\n    /**\r\n     * change object size on hover\r\n     * @param residue\r\n     * @param {boolean} smaller\r\n     * @returns {string | null}\r\n     */\r\n    static changeObjectSize(residue, smaller = true) {\r\n        let objSize = 40;\r\n        if (window.screen.availWidth < 1920) {\r\n            objSize = 30;\r\n        }\r\n        if (window.screen.width < 350) {\r\n            objSize = 5;\r\n        }\r\n        let size = 175;\r\n        if (smaller) {\r\n            size = objSize;\r\n        }\r\n        if (residue.aa === 'GLY') {\r\n            RamachandranComponent.symbolTypes.triangle.size(size);\r\n            return RamachandranComponent.symbolTypes.triangle();\r\n        }\r\n        RamachandranComponent.symbolTypes.circle.size(size);\r\n        return RamachandranComponent.symbolTypes.circle();\r\n    }\r\n    /**\r\n     *\r\n     * @param residue\r\n     * @param {string} pdbId\r\n     * @param {number} ramaContourPlotType\r\n     * @param {number} residueColorStyle\r\n     * @param tooltip\r\n     * @param outliersType\r\n     * @param rsrz\r\n     */\r\n    onMouseOverResidue(residue, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz) {\r\n        let highlightColor = residue.residueColor;\r\n        if (residue.residueColor == '#000')\r\n            highlightColor = 'yellow';\r\n        RamachandranComponent.dispatchCustomEvent('PDB.ramaViewer.mouseOver', residue, pdbId);\r\n        RamachandranComponent.changeContours(residue, false, ramaContourPlotType);\r\n        switch (residueColorStyle) {\r\n            case 1:\r\n                if (residue.rama === 'Favored') {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue) + '<br/> Favored');\r\n                }\r\n                if (residue.rama === 'Allowed') {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue) + '<br/> Allowed');\r\n                }\r\n                if (residue.rama === 'OUTLIER') {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue) + '<br/><b>OUTLIER</b>');\r\n                }\r\n                break;\r\n            case 2:\r\n                let tempStr = '';\r\n                if (typeof outliersType[residue.num] === 'undefined') {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue));\r\n                    break;\r\n                }\r\n                if (outliersType[residue.num].outliersType.includes('clashes')) {\r\n                    tempStr += '<br/>Clash';\r\n                }\r\n                if (outliersType[residue.num].outliersType.includes('ramachandran_outliers')) {\r\n                    tempStr += '<br/>Ramachandran outlier';\r\n                    RamachandranComponent.tooltipWidth = 130;\r\n                }\r\n                if (outliersType[residue.num].outliersType.includes('sidechain_outliers')) {\r\n                    tempStr += '<br/>Sidechain outlier';\r\n                    RamachandranComponent.tooltipWidth = 100;\r\n                }\r\n                if (outliersType[residue.num].outliersType.includes('bond_angles')) {\r\n                    tempStr += '<br/>Bond angles';\r\n                }\r\n                else {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue));\r\n                }\r\n                switch (outliersType[residue.num].outliersType.length) {\r\n                    case 2:\r\n                        RamachandranComponent.tooltipHeight = 68;\r\n                        break;\r\n                    case 3:\r\n                        RamachandranComponent.tooltipHeight = 78;\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n                tooltip.html(RamachandranComponent.tooltipText(residue) + tempStr);\r\n                break;\r\n            case 3:\r\n                if (typeof rsrz[residue.num] === 'undefined') {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue));\r\n                }\r\n                else {\r\n                    tooltip.html(RamachandranComponent.tooltipText(residue) + '<br/><b>RSRZ outlier</b>');\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        tooltip.transition()\r\n            .style('opacity', .95)\r\n            .style('left', (d3.event.pageX + 10) + 'px')\r\n            .style('top', (d3.event.pageY - 48) + 'px')\r\n            .style('height', RamachandranComponent.tooltipHeight)\r\n            .style('width', String(RamachandranComponent.tooltipWidth) + 'px');\r\n        d3.select(`#${residue.idSelector}`)\r\n            .attr('d', (residue) => RamachandranComponent.changeObjectSize(residue, false))\r\n            .style('fill', highlightColor)\r\n            .style('opacity', 1);\r\n        // .style('fill', (dat) => fillColorFunction(dat, drawingType, outliersType, rsrz));\r\n    }\r\n    /**\r\n     *\r\n     * @param residue\r\n     * @param pdbId\r\n     * @param {number} ramaContourPlotType\r\n     * @param {number} residueColorStyle\r\n     * @param tooltip\r\n     * @param outliersType\r\n     * @param rsrz\r\n     */\r\n    onMouseOutResidue(residue, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz) {\r\n        let outTime = new Date().getTime();\r\n        RamachandranComponent.dispatchCustomEvent('PDB.ramaViewer.mouseOut', residue, pdbId);\r\n        if (RamachandranComponent.highlightedResidues.indexOf(residue) > -1) {\r\n            return;\r\n        }\r\n        d3.select(`#${residue.idSelector}`)\r\n            .transition()\r\n            .attr('d', (dat) => RamachandranComponent.changeObjectSize(dat))\r\n            .style('fill', residue.residueColor)\r\n            .style('opacity', () => {\r\n            return RamachandranComponent.computeOpacity(residue.residueColor);\r\n        });\r\n        tooltip.transition()\r\n            .style('opacity', 0);\r\n        if ((outTime - RamachandranComponent.currentTime) > 600) {\r\n            window.setTimeout(() => {\r\n                RamachandranComponent.changeContours(residue, true, ramaContourPlotType);\r\n            }, 50);\r\n        }\r\n    }\r\n    /**\r\n     * change residue coloring\r\n     * @param {number} residueColorStyle\r\n     */\r\n    changeResiduesColors(residueColorStyle) {\r\n        let { tooltip, outliersType, rsrz, onMouseOverResidue, pdbId, ramaContourPlotType, onMouseOutResidue } = this;\r\n        let resArray = RamachandranComponent.residuesOnCanvas;\r\n        if (RamachandranComponent.selectedResidues.length != 0) {\r\n            resArray = RamachandranComponent.selectedResidues.slice(0);\r\n        }\r\n        resArray.forEach((residue) => {\r\n            if (residue.idSelector != '') {\r\n                const node = d3.select(`#${residue.idSelector}`);\r\n                node.style('fill', this.fillColorFunction(residue, residueColorStyle, this.outliersType, this.rsrz));\r\n                node.style('opacity', (residue) => {\r\n                    return RamachandranComponent.computeOpacity(this.fillColorFunction(residue, residueColorStyle, this.outliersType, this.rsrz));\r\n                });\r\n                node.on('mouseover', function () {\r\n                    if (d3.select(`#${residue.idSelector}`).style('opacity') == '0')\r\n                        return;\r\n                    onMouseOverResidue(residue, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz);\r\n                });\r\n                node.on('mouseout', function () {\r\n                    if (d3.select(`#${residue.idSelector}`).style('opacity') == '0')\r\n                        return;\r\n                    window.clearTimeout(RamachandranComponent.timeoutId);\r\n                    onMouseOutResidue(residue, pdbId, ramaContourPlotType, residueColorStyle, tooltip, outliersType, rsrz);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * sort json object to that it can be better displayed\r\n     * @param jsonObject\r\n     * @param {number} drawingType\r\n     * @param {Dictionary} outliersType\r\n     * @param {Dictionary} rsrz\r\n     */\r\n    sortJson(jsonObject, drawingType, outliersType, rsrz) {\r\n        jsonObject.sort((a, b) => {\r\n            // switch (drawingType) {\r\n            //     case 1:\r\n            //         if (a.rama === 'OUTLIER') {\r\n            //             if (b.rama === 'Allowed') {\r\n            //                 return 1;\r\n            //             }\r\n            //             if (b.rama === 'Favored') {\r\n            //                 return 1;\r\n            //             }\r\n            //             if (b.rama === 'OUTLIER') {\r\n            //                 return 0;\r\n            //             }\r\n            //         }\r\n            //         if (a.rama === 'Allowed') {\r\n            //             if (b.rama === 'Allowed') {\r\n            //                 return 0;\r\n            //             }\r\n            //             if (b.rama === 'Favored') {\r\n            //                 return 1;\r\n            //             }\r\n            //             if (b.rama === 'OUTLIER') {\r\n            //                 return -1;\r\n            //             }\r\n            //         }\r\n            //         if (a.rama === 'Favored') {\r\n            //             if (b.rama === 'Allowed') {\r\n            //                 return -1;\r\n            //             }\r\n            //             if (b.rama === 'Favored') {\r\n            //                 return 0;\r\n            //             }\r\n            //             if (b.rama === 'OUTLIER') {\r\n            //                 return -1;\r\n            //             }\r\n            //         }\r\n            //         break;\r\n            //     case 2:\r\n            if (typeof rsrz[a.num] != 'undefined') {\r\n                return 1;\r\n            }\r\n            else if (typeof rsrz[b.num] != 'undefined') {\r\n                return -1;\r\n            }\r\n            else if (typeof outliersType[a.num] == 'undefined') {\r\n                return -1;\r\n            }\r\n            else if (typeof outliersType[b.num] == 'undefined') {\r\n                return 1;\r\n            }\r\n            else if (outliersType[a.num].outliersType.length > outliersType[b.num].outliersType.length) {\r\n                return 1;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n            //     case 3:\r\n            //         if (typeof rsrz[a.num] === 'undefined') {\r\n            //             return -1;\r\n            //         } else if (typeof  rsrz[b.num] === 'undefined') {\r\n            //             return 1;\r\n            //         } else {\r\n            //             return 1;\r\n            //         }\r\n            //     default:\r\n            //         break;\r\n            // }\r\n        });\r\n    }\r\n    /**\r\n     * function to change opacity while hovering\r\n     * @param {string} residuesString\r\n     * @param {boolean} makeInvisible\r\n     */\r\n    static changeOpacity(residuesString, makeInvisible = true) {\r\n        let residues = residuesString.split(',');\r\n        let nodes;\r\n        let resArray = RamachandranComponent.residuesOnCanvas.slice(0);\r\n        if (RamachandranComponent.selectedResidues.length != 0) {\r\n            resArray = RamachandranComponent.selectedResidues.slice(0);\r\n        }\r\n        if (residuesString == '') {\r\n            nodes = resArray.filter((residue) => {\r\n                if (residue.prePro != true)\r\n                    return residue;\r\n            });\r\n        }\r\n        else if (residues.length > 1) {\r\n            nodes = resArray.filter((residue) => {\r\n                return (residues.indexOf(residue.aa) == -1);\r\n            });\r\n        }\r\n        else {\r\n            nodes = resArray.filter((residue) => {\r\n                return (residue.aa != residuesString);\r\n            });\r\n        }\r\n        nodes.forEach((residue) => {\r\n            if (residue.idSelector == '')\r\n                return;\r\n            let node = d3.select(`#${residue.idSelector}`);\r\n            if (makeInvisible)\r\n                // node.style('opacity', 0);\r\n                node.style('display', 'none');\r\n            else {\r\n                node.style('display', 'block');\r\n                // const selection: any = node.node();\r\n                // if (selection.style.fill == 'rgb(0, 128, 0)'\r\n                //     || selection.style.fill == 'black'\r\n                //     || selection.style.fill == 'rgb(0, 0, 0)') {\r\n                //     selection.style.opacity = 0.15;\r\n                //\r\n                // } else if (selection.style.fill == 'rgb(255, 255, 0)') {\r\n                //     selection.style.opacity = 0.8;\r\n                // }else {\r\n                //     selection.style.opacity = 1;\r\n                // }\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * clearContourCanvas\r\n     */\r\n    static clearCanvas() {\r\n        d3.select('#rama-canvas').empty();\r\n        d3.selectAll('.contour-line').remove();\r\n    }\r\n    /**\r\n     * add outliers table\r\n     */\r\n    addTable() {\r\n        this.outliersTable = d3.select('.outliers-container').append('div')\r\n            .attr('class', 'outliers').append('table')\r\n            .attr('class', 'table table-hover table-responsive');\r\n        d3.select('.outliers-container').append('table')\r\n            .attr('class', 'rama-outliers-table').append('thead').append('tr').attr('id', 'tab-headline');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Chain')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('ID')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('AA')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Phi')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n        d3.select('#tab-headline').append('th').attr('class', 'rama-table-headline').text('Psi')\r\n            .style('width', '30%').style('min-width', '50px').style('text-align', 'right');\r\n    }\r\n    /**\r\n     * fill outliers table\r\n     * @param {any[]} sortedTable\r\n     * @param {number} drawingType\r\n     */\r\n    fillTable(sortedTable, drawingType) {\r\n        let objSize = 40;\r\n        const { fillColorFunction, outliersType, rsrz } = this;\r\n        if (window.screen.availWidth < 1920) {\r\n            objSize = 30;\r\n        }\r\n        if (window.screen.width < 350) {\r\n            objSize = 5;\r\n        }\r\n        const symbolTypes = {\r\n            circle: d3.symbol().type(d3.symbolCircle).size(30),\r\n            triangle: d3.symbol().type(d3.symbolTriangle).size(30)\r\n        };\r\n        const rows = this.outliersTable.selectAll('tbody tr')\r\n            .data(sortedTable, (d) => d.num);\r\n        rows.enter()\r\n            .append('tr')\r\n            .on('mouseover', function (d) {\r\n            d3.select(this)\r\n                .style('background-color', '#b4bed6')\r\n                .style('cursor', 'pointer');\r\n            d3.select('#' + '-' + d.chainId + '-' + d.modelId + '-' + d.num)\r\n                .attr('d', (dat) => {\r\n                if (dat.aa === 'GLY') {\r\n                    symbolTypes.triangle.size(175);\r\n                    return symbolTypes.triangle();\r\n                }\r\n                symbolTypes.circle.size(175);\r\n                return symbolTypes.circle();\r\n            })\r\n                .style('fill', (residue) => fillColorFunction(residue, drawingType, outliersType, rsrz));\r\n        })\r\n            //\r\n            .on('mouseout', function (d) {\r\n            d3.select(this)\r\n                .style('background-color', 'transparent')\r\n                .style('cursor', 'default');\r\n            d3.select('#' + d.aa + '-' + d.chainId + '-' + d.modelId + '-' + d.num)\r\n                .transition()\r\n                // .duration(50)\r\n                .attr('d', (dat) => {\r\n                if (dat.aa === 'GLY') {\r\n                    symbolTypes.triangle.size(objSize);\r\n                    return symbolTypes.triangle();\r\n                }\r\n                symbolTypes.circle.size(objSize);\r\n                return symbolTypes.circle();\r\n            })\r\n                .style('fill', (residue) => fillColorFunction(residue, drawingType, outliersType, rsrz))\r\n                .style('fillColorFunction-width', '0.5');\r\n        })\r\n            .selectAll('td')\r\n            .data((d) => [d.chainId, d.num, d.aa, d.phi, d.psi])\r\n            .enter()\r\n            .append('td')\r\n            .attr('id', 'rama-td')\r\n            .style('width', '30%')\r\n            .style('min-width', '50px')\r\n            .style('text-align', 'right')\r\n            .text((d) => d);\r\n        rows.exit().remove();\r\n        //\r\n        const cells = rows.selectAll('td')\r\n            .data((d) => [d.chainId, d.num, d.aa, d.phi, d.psi])\r\n            .text((d) => d);\r\n        //\r\n        cells.enter()\r\n            .append('td')\r\n            .text((d) => d);\r\n        cells.exit().remove();\r\n    }\r\n}\r\nwindow.customElements.define('ramachandran-component', RamachandranComponent);\r\n"]}